import{J as a,C as c,L as Re,N as ze}from"./node-modules-DrsikI7u.js";import{B as I,d as Oe,L as Ue,I as Ge,a as $e,u as Le,b as Be,c as Ne,e as _e,T as De,f as Ae,g as be,h as Fe,i as qe,j as Se,k as Je,l as Ye,m as Ke,C as Qe,n as Xe,o as Ze,p as Ve}from"./mui-B5HmvuA6.js";import{E as et}from"./jspdf-B58vhZxU.js";import"./index-CPn0HBg1.js";import"./emotion-k7tECRHi.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();var qt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Yt(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function s(){return this instanceof s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(s){var i=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:function(){return e[s]}})}),n}function we({color:e}){return a.jsx(I,{bgcolor:e,height:"1px",width:"100vw"})}function tt(){const e=new Date().getFullYear();return a.jsxs(I,{alignItems:"center",className:"footer",color:"gray",component:"footer",display:"flex",flexWrap:"wrap",gap:1,justifyContent:"center",px:2,py:1,width:"100%",children:[a.jsxs(I,{alignItems:"center",display:"flex",gap:1,whiteSpace:"nowrap",children:[a.jsx(Oe,{fontSize:"small"})," ",e," Kelly Ripple,"]}),a.jsxs(I,{alignItems:"center",display:"flex",gap:1,whiteSpace:"nowrap",children:[a.jsx(Ue,{color:"inherit",href:"https://github.com/twitter/twemoji",tabIndex:-1,target:"_blank",underline:"none",whiteSpace:"nowrap",children:"Favicon by Twemoji"}),a.jsx(Ge,{"aria-label":"license",color:"inherit",href:"https://creativecommons.org/licenses/by/4.0",size:"small",style:{padding:0},tabIndex:-1,title:"CC-BY 4.0",children:a.jsx($e,{fontSize:"small"})})]})]})}function ae(){return Le("(max-width:750px)")}function ie({color:e,component:t,testId:n,disabled:s,hiddenInput:i,icon:r,label:o,loading:l,newTab:d,tabIndex:g=0,iconButton:m,type:h="button",maxWidth:f,...x}){const j=ae(),w={display:"flex",flexGrow:1,minHeight:"40px",whiteSpace:"nowrap"},H=m?{paddingLeft:"9px",paddingRight:"9px",minWidth:"unset"}:{},C="rgba(255, 255, 255, 0.12)",W=e?w:{...w,...H,borderBottomColor:C,borderLeftColor:C,borderRightColor:C,borderTopColor:C},S=s===!0?{disabled:s}:{};return a.jsxs(Be,{"aria-label":o,color:e||"inherit",component:t||(x.onClick?"button":"label"),"data-testid":n||"Button",fullWidth:j,loading:l,loadingPosition:"center",role:void 0,startIcon:m?void 0:r,style:W,tabIndex:g,target:d?"_blank":void 0,title:o,type:h,variant:"outlined",...x,...S,children:[m?r:o,i]})}function nt({disabled:e,loading:t,onClick:n}){return a.jsx(ie,{color:"secondary",disabled:e,icon:a.jsx(Ne,{}),label:"Download",loading:t,onClick:n})}function J({units:e="inches",style:t,readOnly:n,...s}){const i=c.useMemo(()=>({InputProps:{endAdornment:e==="inches"?a.jsx(_e,{position:"end",children:"in"}):void 0,readOnly:n}}),[e,n]);return a.jsx(De,{autoComplete:"off",fullWidth:!1,size:"small",style:{display:"flex",flexGrow:1,...t},tabIndex:-1,type:"text",...i,...s})}function rt(e){const t=ae(),[n,s]=c.useState(e.orientation||"portrait");c.useEffect(()=>{e.orientation&&s(e.orientation)},[e.orientation]);const i={display:"flex",flexGrow:1},r=c.useCallback(o=>{if(!e.setOrientation||!("value"in o.currentTarget))throw Error("[handleClick] missing required properties");const l=o.currentTarget.value;e.setOrientation(l==="portrait"?"portrait":"landscape")},[e.setOrientation]);return a.jsxs(Ae,{"aria-label":"text alignment",disabled:!s,fullWidth:t,size:"small",style:i,value:n,children:[a.jsx(be,{"aria-label":"portrait",onClick:r,style:i,tabIndex:0,title:"Portrait",value:"portrait",children:a.jsx(Fe,{})}),a.jsx(be,{"aria-label":"landscape",onClick:r,style:i,tabIndex:0,title:"Landscape",value:"landscape",children:a.jsx(qe,{})})]})}function it({canceling:e,disabled:t,loading:n,onCancel:s}){const i=ae(),r={display:"flex",flexGrow:1};return a.jsxs(Se,{fullWidth:i,style:r,children:[a.jsx(ie,{color:"success",component:"button",disabled:t,icon:a.jsx(Je,{}),iconButton:!0,label:"Apply Changes",loading:n,testId:"SubmitButton",type:"submit"}),a.jsx(ie,{color:"primary",disabled:!s,icon:a.jsx(Ye,{}),iconButton:!0,label:"Undo Changes",loading:e,onClick:s})]})}function st({disabled:e,loading:t,onChange:n}){return a.jsx(ie,{color:"info",disabled:e,hiddenInput:a.jsx("input",{accept:"image/jpeg,image/png",disabled:e,hidden:!0,onChange:n,type:"file"}),icon:a.jsx(Ke,{}),label:"Upload",loading:t})}function Y(e){const[t,n]=c.useState(e),s=c.useCallback(i=>{n(i)},[]);return c.useEffect(()=>{n(e)},[e]),[t,s]}const Ie=c.createContext(void 0),je=()=>{const e=c.useContext(Ie);if(!e)throw Error("useStatusContext must be called within a StatusProvider");return e},ot=()=>{const{isUpdating:e,setIsUpdating:t}=je();return[e,t]},at=()=>{const{isToggling:e,setIsToggling:t}=je();return[e,t]},ct=e=>{if(e==="isUpdating")return ot;if(e==="isToggling")return at;throw console.debug(`[useStatus] unsupported status '${e}'`),Error("[useStatus] unsupported status")},he=e=>ct(e)();function lt(e){return typeof e=="string"}function gt(e){return e!==e}function V(e){return typeof e=="number"&&!gt(e)}const B=(e,t={integer:!1})=>{const n=[".","0","1","2","3","4","5","6","7","8","9"];t.integer&&n.shift();const s=[];for(const i of e)n.includes(i)&&(s.push(i),i==="."&&n.shift());return s.join("")},We=(e,t={integer:!1})=>{const n=Math.abs(e);return n>99999?99999:t!=null&&t.integer?Math.ceil(n):Math.round(n*100)/100},ut=(e,t={integer:!1})=>{const n=B(e),s=parseFloat(n);return Number.isNaN(s)?"":We(s,t).toString()};function T(e,t={integer:!1}){if(V(e))return We(e,t);if(lt(e))return ut(e,t);throw TypeError}const pe=e=>`${e.toFixed(2)}px`,z=(e,t)=>{if(t&&t.minimum&&t.maximum&&t.minimum>t.maximum)throw Error(`[getNumber] minimum value '${t.minimum}' is greater than maximum value '${t.maximum}'`);const n=V(t==null?void 0:t.minimum)?t.minimum:0,s=V(t==null?void 0:t.maximum)?t.maximum:void 0,i=parseFloat(e);return V(i)?s===void 0?Math.max(n,i):Math.min(Math.max(n,i),s):n};function K(e,t,n={integer:!1}){const s=V(e)?e.toString():e;return t===""||(t&&s?T(t,{integer:n.integer})!==T(s,{integer:n.integer}):!1)}const me=({inches:e,pixelsPerInch:t})=>Math.floor(e*t),Q=({pixels:e,pixelsPerInch:t})=>e/t,Ce=({inches:e,pixels:t})=>{const n=Math.floor(t/e);return n>0?n:1},ye=1,se=2.5,oe=100,dt=({imageHeight:e,imageHeightPixels:t,imageWidth:n,imageWidthPixels:s})=>{const o=e>=n?t:s,l=Math.max(Math.ceil(o/100),1);return{minimumPixelsPerInch:l,maximumImageHeight:T(Q({pixelsPerInch:l,pixels:t})),maximumImageWidth:T(Q({pixelsPerInch:l,pixels:s}))}},He=({height:e,width:t})=>{const n=Math.min(e,t);return T(n/4)};function mt({changeImage:e,image:t,download:n,update:s,orientation:i,...r}){const o=ae(),[l,d]=he("isToggling"),[g,m]=Y(r.imageHeight),[h,f]=Y(r.imageWidth),[x,j]=Y(r.pageHeight.toString()),[w,H]=Y(r.pageWidth.toString()),[C,W]=Y(r.pageMargin.toString()),[S,G]=Y(r.pixelsPerInch.toString()),O=c.useCallback(b=>{const v=B(b.currentTarget.value);m(v||" ")},[]),N=c.useCallback(b=>{const v=B(b.currentTarget.value);f(v||" ")},[]),U=c.useCallback(b=>{const v=B(b.currentTarget.value);j(v||" ")},[]),_=c.useCallback(b=>{const v=B(b.currentTarget.value);H(v||" ")},[]),$=c.useCallback(b=>{const v=B(b.currentTarget.value);W(v||" ")},[]),D=c.useCallback(b=>{const v=B(b.currentTarget.value,{integer:!0});G(v||" ")},[]),L=K(r.imageHeight,g),k=K(r.imageWidth,h),ce=K(r.pageHeight,x),le=K(r.pageWidth,w),ge=K(r.pageMargin,C),A=K(r.pixelsPerInch,S,{integer:!0}),P=(L||k||ce||le||ge||A)&&!l,F=c.useCallback(b=>{if(b.preventDefault(),!t||!s)throw Error("[handleUpdate] missing required properties");const v=z(g,{minimum:ye}),te=z(h,{minimum:ye}),{minimumPixelsPerInch:de,maximumImageHeight:ne,maximumImageWidth:re}=dt({imageHeight:v,imageHeightPixels:t.height,imageWidth:te,imageWidthPixels:t.width}),p=L?Ce({inches:Math.min(v,ne),pixels:t.height}):k?Ce({inches:Math.min(te,re),pixels:t.width}):z(S,{minimum:de}),u=z(x,{minimum:se,maximum:oe}),y=z(w,{minimum:se,maximum:oe}),R=He({width:y,height:u}),X=z(C,{maximum:R}),xe=Q({pixels:t.height,pixelsPerInch:p}),M=Q({pixels:t.width,pixelsPerInch:p});s({imageHeight:T(xe.toString()),imageWidth:T(M.toString()),pageHeight:u,pageWidth:y,pageMargin:X,pixelsPerInch:p,orientation:i}),E()},[g,h,x,w,C,S,i,s]),E=c.useCallback(()=>{m(r.imageHeight),f(r.imageWidth),j(r.pageHeight.toString()),H(r.pageWidth.toString()),W(r.pageMargin.toString()),G(r.pixelsPerInch.toString())},[r.imageHeight,r.imageWidth,r.pageHeight,r.pageWidth,r.pageMargin,r.pixelsPerInch]),ee=c.useCallback(b=>{if(!s)throw Error("[handleSetOrientation] missing required properties");b!==i&&(d(!0),s({imageHeight:r.imageHeight,imageWidth:r.imageWidth,pageHeight:r.pageWidth,pageWidth:r.pageHeight,pageMargin:r.pageMargin,pixelsPerInch:r.pixelsPerInch,orientation:b}),E())},[r.imageHeight,r.imageWidth,r.pageHeight,r.pageWidth,r.pageMargin,r.pixelsPerInch,i,s]);return a.jsxs(I,{alignItems:"center",component:"header","data-testid":"Header",display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center",p:2,position:"relative",width:"100%",children:[a.jsxs(Se,{fullWidth:o?!0:void 0,orientation:o?"vertical":"horizontal",style:{flexGrow:1,justifyContent:"center",display:o?"flex":"grid",gridTemplateColumns:o?void 0:"repeat(2, 1fr)"},children:[a.jsx(st,{disabled:!e,onChange:e}),a.jsx(nt,{disabled:!n||P,onClick:n})]}),a.jsx("form",{autoComplete:"off",noValidate:!0,onSubmit:F,style:{display:"flex",flexGrow:1},children:a.jsxs(I,{display:"flex",flexGrow:1,flexWrap:"wrap",gap:2,children:[a.jsxs(I,{display:"flex",flexGrow:1,gap:2,children:[a.jsx(J,{disabled:L||A,label:"Width",name:"imageWidth",onChange:N,value:h||" "}),a.jsx(J,{disabled:k||A,label:"Height",name:"imageHeight",onChange:O,value:g||" "})]}),a.jsx(J,{disabled:L||k,label:"DPI",name:"pixelsPerInch",onChange:D,style:{display:o?"none":"flex"},units:"none",value:S.toString()}),a.jsx(J,{label:"Print Margin",name:"pageMargin",onChange:$,style:{display:o?"none":"flex"},value:C.toString()}),a.jsxs(I,{display:o?"none":"flex",flexGrow:1,gap:2,children:[a.jsx(J,{label:"Paper Width",name:"pageWidth",onChange:_,style:{display:o?"none":"flex"},value:w}),a.jsx(J,{label:"Paper Height",name:"pageHeight",onChange:U,style:{display:o?"none":"flex"},value:x})]}),a.jsx(rt,{orientation:i,setOrientation:s?ee:void 0}),a.jsx(it,{disabled:!P,onCancel:P?E:void 0})]})})]})}function ht({composite:{previews:e,props:{columnCount:t,rowCount:n,pageCount:s,screenPadding:i,screenGridHeight:r,screenGridWidth:o}}}){const[l,d]=c.useState([]);return c.useEffect(()=>{const g=e.concat(Array(s-e.length).fill({src:"placeholder"}));d(g)},[e,s]),a.jsx(I,{alignContent:"center",bottom:"0",display:"grid",gridTemplateColumns:`repeat(${t}, ${pe(o)})`,gridTemplateRows:`repeat(${n}, ${pe(r)})`,justifyContent:"center",left:"0",position:"absolute",right:"0",top:"0",children:l.map(({src:g,pageNumber:m},h)=>{const f=g==="placeholder",x=`${i/2}px`;return a.jsx(I,{position:"relative",children:a.jsx(Qe,{image:g,style:{position:"absolute",top:x,bottom:x,left:x,right:x}})},f?`${g}-${h}`:`page-${m}`)})})}function pt({screenSizeRef:e}){return a.jsx(I,{height:"100%",position:"absolute",ref:e,width:"100%"})}function ft({props:e,previews:t,screenSizeRef:n}){return a.jsxs(I,{"data-testid":"Previews",display:"flex",flexDirection:"column",height:"100%",position:"relative",width:"100%",children:[a.jsx(pt,{screenSizeRef:n}),t&&e?a.jsx(ht,{composite:{previews:t,props:e}}):null]})}const xt={useResizeDetector:Re},Me=c.createContext(void 0),Pt=()=>{const e=c.useContext(Me);if(!e)throw Error("useParamsContext must be called within a ParamsProvider");return e},Te=c.createContext(void 0),ke=()=>{const e=c.useContext(Te);if(!e)throw Error("useThemeContext must be called within a ThemeProvider");return e},bt=()=>{const{theme:e}=ke();return e},wt=()=>{const e=bt(),{colors:t}=ke(),{primary:n,secondary:s,success:i,info:r,warning:o,error:l,common:d,background:g}=e.palette;return{primary:n.main,secondary:s.main,success:i.main,info:r.main,warning:o.main,error:l.main,white:d.white,black:d.black,background:g.default,...t}},Ct="production",yt="08b3fa7f50bd20e6839337425720782fecb3bf7a",vt=({image:e,compositeHeight:t,compositeWidth:n})=>{if(t===0||n===0)throw Error("[getCompositeUrlPromise] dimensions are invalid");const s="image/png",i=new OffscreenCanvas(n,t),r=i.getContext("2d");if(r===null)throw Error("[getCompositeUrlPromise] null context");r.fillStyle="white",r.fillRect(0,0,i.width,i.height);const o=Math.floor((i.width-e.width)/2),l=Math.floor((i.height-e.height)/2);return r.drawImage(e,o,l,e.width,e.height),i.convertToBlob({type:s}).then(g=>URL.createObjectURL(g))},St=({src:e,onload:t})=>{const n=new Image;return n.src=e,t&&(n.onload=t),n},fe=({src:e})=>new Promise(t=>{const n=St({src:e,onload:function(){t(n)}})}),It=({image:e,pageImageHeight:t,pageImageWidth:n})=>{const s=({size:h,imageSize:f})=>h>=f?1:Math.ceil(f/h),i=s({size:n,imageSize:e.width}),r=s({size:t,imageSize:e.height}),o=t*r,l=n*i,d=[];let g=1;for(let h=0;h<o;h+=t)for(let f=0;f<l;f+=n)d.push({sx:f,sy:h,pageNumber:g}),g+=1;return{compositeHeight:o,compositeWidth:l,rowCount:r,columnCount:i,pageCount:r*i,coordinates:d}},jt=({screenHeight:e,screenWidth:t,columnCount:n,rowCount:s,pageHeight:i,pageWidth:r,pageHeightInches:o,pageWidthInches:l})=>{const g=t/n-4,m=e/s-4,h=g/r,f=m/i,x=Math.min(h,f),j=x*r,w=x*i,H=j+4,C=w+4,W=g/l,S=m/o;return{screenSpacing:Math.min(W,S),screenPadding:4,screenGridHeight:C,screenGridWidth:H}};function Wt({image:e,pageHeight:t,pageWidth:n,pageMargin:s,pixelsPerInch:i,screenHeight:r,screenWidth:o,resize:l}){const d=me({inches:t,pixelsPerInch:i}),g=me({inches:n,pixelsPerInch:i}),m=me({inches:s,pixelsPerInch:i}),h=2*m,f=d-h,x=g-h,j=Q({pixels:f,pixelsPerInch:i}),w=Q({pixels:x,pixelsPerInch:i}),{compositeHeight:H,compositeWidth:C,rowCount:W,columnCount:S,pageCount:G,coordinates:O}=It({image:e,pageImageHeight:f,pageImageWidth:x}),{screenSpacing:N,screenPadding:U,screenGridHeight:_,screenGridWidth:$}=jt({screenHeight:r,screenWidth:o,pageHeight:d,pageWidth:g,columnCount:S,rowCount:W,pageHeightInches:t,pageWidthInches:n});return l?{screenSpacing:N,screenPadding:U,screenGridHeight:_,screenGridWidth:$}:vt({compositeHeight:H,compositeWidth:C,image:e}).then(D=>fe({src:D}).then(k=>({id:k.src,composite:k,rowCount:W,columnCount:S,pageCount:G,coordinates:O,pageHeight:d,pageWidth:g,pageMargin:m,pageHeightInches:t,pageWidthInches:n,pageMarginInches:s,pageImageHeight:f,pageImageWidth:x,pageImageHeightInches:j,pageImageWidthInches:w,screenSpacing:N,screenPadding:U,screenGridHeight:_,screenGridWidth:$})))}const Ht=({id:e,composite:t,height:n,width:s,sx:i,sy:r,margin:o,pageNumber:l,pageCount:d})=>{if(n===0||s===0)throw Error("[getPagePromise] dimensions are invalid");const g="image/png",m=o*2,h=new OffscreenCanvas(s+m,n+m),f=h.getContext("2d");if(f===null)throw Error("[getPagePromise] null context");return f.fillStyle="white",f.fillRect(0,0,h.width,h.height),f.drawImage(t,i,r,s,n,o,o,s,n),h.convertToBlob({type:g}).then(j=>({src:URL.createObjectURL(j),pageNumber:l,pageCount:d,id:e}))},Mt="modulepreload",Tt=function(e){return"/map-slicer/"+e},ve={},Kt=function(t,n,s){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),o=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));i=Promise.all(n.map(l=>{if(l=Tt(l),l in ve)return;ve[l]=!0;const d=l.endsWith(".css"),g=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${g}`))return;const m=document.createElement("link");if(m.rel=d?"stylesheet":Mt,d||(m.as="script",m.crossOrigin=""),m.href=l,o&&m.setAttribute("nonce",o),document.head.appendChild(m),d)return new Promise((h,f)=>{m.addEventListener("load",h),m.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}return i.then(()=>t()).catch(r=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=r,window.dispatchEvent(o),!o.defaultPrevented)throw r})},kt=({images:e,height:t,width:n})=>{const s={orientation:n>t?"landscape":"portrait",format:[n,t],unit:"in"},i="PNG";return e.reduce((r,o,l)=>{const d=l+1,g={format:i,imageData:o,x:0,y:0,width:n,height:t};return r.addImage(g),d!==e.length&&r.addPage(s.format,s.orientation),r},new et(s)).output("datauristring")};function Et({changeImage:e,image:t}){var ne,re;const n=c.useCallback(Wt,[]),s=c.useCallback(Ht,[]),[,i]=he("isUpdating"),[,r]=he("isToggling"),o=c.useRef(),l=c.useCallback(p=>new Promise((u,y)=>{if(p.id!==o.current)y("id mismatch");else{const R=s(p);u({promise:R,reject:y})}}),[]),d=Pt(),g=wt(),{height:m,width:h,ref:f}=xt.useResizeDetector({refreshMode:"throttle",refreshRate:50}),x=c.useRef(),j=c.useRef(!0),[w,H]=c.useState();c.useEffect(()=>{if(!m||!h)return;if(j.current){j.current=!1,H({screenHeight:m,screenWidth:h});return}if(!x.current)return;const p=n({...x.current,screenHeight:m,screenWidth:h,resize:!0});A(p.screenSpacing),F(u=>!u.image||!u.previews||!u.props?u:{...u,props:{...u.props,screenPadding:p.screenPadding,screenGridHeight:p.screenGridHeight,screenGridWidth:p.screenGridWidth}})},[m,h]);const[C,W]=c.useState(d.pageMargin),[S,G]=c.useState(d.pageHeight),[O,N]=c.useState(d.pageWidth),[U,_]=c.useState(72),[$,D]=c.useState(d.orientation),[L,k]=c.useState("16"),[ce,le]=c.useState("23"),[ge,A]=c.useState(23.32),ue=pe(ge),[P,F]=c.useState({}),E=c.useRef(),ee=c.useCallback(p=>{p.id===o.current&&F(u=>{const y=u.previews?[...u.previews]:[];return y.push(p),{...u,previews:y}})},[]);c.useEffect(()=>{if(!t||!w)return;const p={image:t,pageMargin:C,pageHeight:S,pageWidth:O,pixelsPerInch:U,screenHeight:w.screenHeight,screenWidth:w.screenWidth};x.current=p,b(),n(p).then(u=>{o.current=u.composite.src,A(u.screenSpacing),F({image:u.composite,props:{columnCount:u.columnCount,rowCount:u.rowCount,pageCount:u.pageCount,screenPadding:u.screenPadding,screenGridHeight:u.screenGridHeight,screenGridWidth:u.screenGridWidth}}),E.current={height:u.pageImageHeightInches,width:u.pageImageWidthInches};const y=[];for(const[M,{sx:Z,sy:q}]of u.coordinates.entries())y.push({id:u.id,height:u.pageImageHeight,width:u.pageImageWidth,composite:u.composite,sx:Z,sy:q,margin:u.pageMargin,pageNumber:M+1,pageCount:u.pageCount});const R=y.shift();if(!R)return;const X=l(R);y.reduce((M,Z)=>M.then(({promise:q,reject:Ee})=>q.then(Pe=>(Pe.id!==o.current?Ee("id mismatch"):ee(Pe),l(Z)))),X).then(({promise:M,reject:Z})=>M.then(q=>{q.id!==o.current?Z("id mismatch"):(ee(q),i(!1),r(!1))})).catch(M=>{M!=="id mismatch"&&console.warn(M)})}).catch(u=>{u!=="id mismatch"&&console.warn(u)})},[t,S,O,C,U,$,w]);const b=c.useCallback(()=>{F({}),o.current=void 0},[]),v=c.useCallback(p=>{k(p.imageHeight),le(p.imageWidth),W(p.pageMargin),G(p.pageHeight),N(p.pageWidth),_(p.pixelsPerInch),D(p.orientation)},[]),te=E.current&&P.previews&&((ne=P.props)==null?void 0:ne.pageCount)&&P.props.pageCount===P.previews.length,de=c.useCallback(()=>{var p;if(!(E.current&&P.previews&&((p=P.props)!=null&&p.pageCount)&&P.props.pageCount===P.previews.length))throw Error("[createPdf] missing required properties");setTimeout(async()=>{var R;if(!(E.current&&P.previews&&((R=P.props)!=null&&R.pageCount)&&P.props.pageCount===P.previews.length))throw Error("[createPdf] missing required properties");const u=kt({...E.current,images:P.previews.map(X=>X.src)}),y=document.createElement("a");y.download="download",y.href=u,y.click()})},[P.previews,(re=P.props)==null?void 0:re.pageCount]);return a.jsxs(I,{alignItems:"center","data-env":Ct,"data-testid":"App","data-version":yt,display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",children:[a.jsx(mt,{changeImage:e,download:te?de:void 0,image:t,imageHeight:L,imageWidth:ce,orientation:$,pageHeight:S,pageMargin:C,pageWidth:O,pixelsPerInch:U,update:t?v:void 0}),a.jsx(we,{color:g.divider}),a.jsx(I,{alignItems:"center",boxSizing:"border-box",component:"main",display:"flex",flexGrow:1,justifyContent:"center",p:2,position:"relative",style:{backgroundSize:`${ue} ${ue}`,backgroundImage:`linear-gradient(to right, ${g.grid} 1px, transparent 1px), linear-gradient(to bottom, ${g.grid} 1px, transparent 1px)`,backgroundPosition:"center"},width:"100%",children:a.jsx(ft,{previews:P.previews,props:P.props,screenSizeRef:f})}),a.jsx(we,{color:g.divider}),a.jsx(tt,{})]})}const Rt=e=>{const t=c.useRef(!0);c.useEffect(()=>{t.current&&(t.current=!1,e())},[])};function zt({children:e}){const t=c.useMemo(()=>{const n=new URLSearchParams(window.location.search),s=T(z(n.get("paperHeight")||"11",{minimum:se,maximum:oe})),i=T(z(n.get("paperWidth")||"8.5",{minimum:se,maximum:oe})),r=He({height:s,width:i}),o=T(z(n.get("printMargin")||"0.25",{maximum:r})),l=n.get("orientation")==="landscape"?"landscape":"portrait";return{pageHeight:s,pageWidth:i,pageMargin:o,orientation:l}},[]);return a.jsx(Me.Provider,{value:t,children:e})}function Ot({src:e}){const[t,n]=c.useState(null);Rt(()=>{fe({src:e}).then(i=>{n(i)})});const s=c.useCallback(i=>{(({files:o})=>{if(o&&o.length>0){const l=o.item(0);if(l){const d=URL.createObjectURL(l);fe({src:d}).then(g=>{n(g)})}else console.warn("[ImageLoader] unknown error occured during file upload")}else console.warn("[ImageLoader] file is missing")})({files:i.target.files})},[]);return a.jsx(zt,{image:t,children:a.jsx(Et,{changeImage:s,image:t})})}const Ut="/map-slicer/assets/forest-Bl8z6JIJ.jpg",Gt=(e,t,n,s)=>{c.useRef(e),c.useEffect(()=>{},[e])};function $t({children:e}){const[t,n]=c.useState("dark"),s={divider:"rgba(255, 255, 255, 0.36)",grid:"rgba(255, 255, 255, 0.12)"},i=c.useMemo(()=>Xe({components:{MuiButtonBase:{defaultProps:{focusRipple:!1}}},palette:{mode:t}}),[t]),r=c.useCallback(()=>n(l=>l==="light"?"dark":"light"),[]),o=c.useMemo(()=>({colors:s,mode:t,theme:i,toggleMode:r}),[t,i]);return Gt({children:e,mode:t,theme:i,memo:o}),a.jsx(Te.Provider,{value:o,children:a.jsxs(Ze,{theme:i,children:[a.jsx(Ve,{enableColorScheme:!0}),e]})})}function Lt({children:e}){const[t,n]=c.useState(!1),[s,i]=c.useState(!1),r=c.useMemo(()=>({isUpdating:t,setIsUpdating:o=>n(o),isToggling:s,setIsToggling:o=>i(o)}),[t,s]);return a.jsx(Ie.Provider,{value:r,children:e})}function Bt({children:e}){return a.jsx($t,{children:a.jsx(Lt,{children:e})})}ze(document.getElementById("root")).render(a.jsx(Bt,{children:a.jsx(Ot,{src:Ut})}));export{Kt as _,Jt as a,qt as c,Yt as g};
