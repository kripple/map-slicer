import{J as o,C as u,L as se}from"./node-modules-BiOpm7kD.js";import{B as y,d as re,L as ie,I as ae,a as ce,b as le,c as ue,T as L,e as N,f as de,g as fe,h as he,i as me,S as ge,j as pe,k as xe,C as be}from"./mui-Cp7iXbur.js";import{E as we}from"./jspdf-DzLhBT4N.js";import"./index-ClRT4N-h.js";import"./emotion-DPnaPopK.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();var et=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function tt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function nt(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function s(){return this instanceof s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(s){var r=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(n,s,r.get?r:{enumerable:!0,get:function(){return e[s]}})}),n}function F({color:e}){return o.jsx(y,{bgcolor:e,height:"1px",width:"100vw"})}function je(){const e=new Date().getFullYear();return o.jsxs(o.Fragment,{children:[o.jsxs(y,{alignItems:"center",display:"flex",gap:1,whiteSpace:"nowrap",children:[o.jsx(re,{fontSize:"small"})," ",e," Kelly Ripple,"]}),o.jsxs(y,{alignItems:"center",display:"flex",gap:1,whiteSpace:"nowrap",children:[o.jsx(ie,{color:"inherit",href:"https://github.com/twitter/twemoji",target:"_blank",underline:"none",whiteSpace:"nowrap",children:"Favicon by Twemoji"}),o.jsx(ae,{"aria-label":"license",color:"inherit",href:"https://creativecommons.org/licenses/by/4.0",size:"small",sx:{padding:0},title:"CC-BY 4.0",children:o.jsx(ce,{fontSize:"small"})})]})]})}const U=u.createContext(void 0),ye=()=>{const e=u.useContext(U);if(!e)throw Error("useThemeContext must be called within a ThemeProvider");return e},Ce=()=>{const{theme:e}=ye();return e},ve=()=>{const e=Ce(),{primary:t,secondary:n,success:s,info:r,warning:i,error:a,common:c,background:l}=e.palette;return{primary:t.main,secondary:n.main,success:s.main,info:r.main,warning:i.main,error:a.main,white:c.white,black:c.black,background:l.default}};function M({backgroundImage:e,borderColor:t,children:n,component:s,header:r}){const{success:i,info:a,warning:c}=ve(),l=t==="green"?i:t==="blue"?a:c;return o.jsxs(y,{alignItems:"center","data-env":"production","data-testid":s,"data-version":"7221bb7e2398741ebef3b31f564ecaf2d00fa017",display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",children:[o.jsx(y,{alignItems:"center",component:"header",display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center",p:2,width:"100vw",children:r}),o.jsx(F,{color:l}),o.jsx(y,{className:"main",component:"main",m:1,style:{backgroundImage:e},sx:{backgroundRepeat:"no-repeat",backgroundSize:"contain",backgroundPosition:"center"},children:n}),o.jsx(F,{color:l}),o.jsx(y,{alignItems:"center",className:"footer",color:"gray",component:"footer",display:"flex",flexWrap:"wrap",gap:1,justifyContent:"center",p:2,width:"100vw",children:o.jsx(je,{})})]})}function S({color:e,component:t,disabled:n,extendedLabel:s,hiddenInput:r,icon:i,label:a,loading:c,newTab:l,...f}){return o.jsxs(le,{"aria-label":a,className:"header-item",color:e,component:t||(f.onClick?"button":"label"),disabled:n,loading:c,loadingPosition:"start",role:void 0,startIcon:i,sx:{paddingTop:"7px",paddingBottom:"6.5px"},tabIndex:-1,target:l?"_blank":void 0,title:a,variant:"outlined",...f,children:[a,r]})}function $({disabled:e,loading:t,fileName:n,href:s}){const r=()=>{const i=document.createElement("a");n&&(i.download=n),s&&(i.href=s),i.click()};return o.jsx(o.Fragment,{children:o.jsx(S,{color:"info",disabled:e||!s,extendedLabel:"download slices",icon:o.jsx(ue,{}),label:"Download",loading:t,onClick:r})})}function H(e){return o.jsx(L,{InputProps:{endAdornment:o.jsx(N,{position:"end",children:"in"})},autoComplete:"off",className:"header-item",fullWidth:!1,size:"small",tabIndex:0,type:"text",...e})}function D({disabled:e,loading:t,onClick:n}){return o.jsx(S,{color:"warning",disabled:e,icon:o.jsx(de,{}),label:"Slice",loading:t,onClick:n})}function G({canceling:e,disabled:t,loading:n,onClick:s,onCancel:r}){return o.jsxs(o.Fragment,{children:[o.jsx(S,{color:"success",disabled:t,icon:o.jsx(fe,{}),label:"Update",loading:n,onClick:s}),o.jsx(S,{color:"error",disabled:t,icon:o.jsx(he,{}),label:"Cancel",loading:e,onClick:r})]})}function q({disabled:e,loading:t,onChange:n}){return o.jsx(S,{color:"primary",disabled:e,hiddenInput:o.jsx("input",{accept:"image/jpeg,image/png",disabled:e,hidden:!0,onChange:n,type:"file"}),icon:o.jsx(me,{}),label:"Upload",loading:t})}function Se(e){return typeof e=="string"}function Ie(e){return e!==e}function ke(e){return typeof e=="number"&&!Ie(e)}const O=e=>{const t=[".","0","1","2","3","4","5","6","7","8","9"],n=[];for(const s of e)t.includes(s)&&(n.push(s),s==="."&&t.shift());return n.join("")},J=e=>{const t=Math.abs(e);return t>99999?99999:Math.round(t*100)/100},Ee=e=>{const t=O(e),n=parseFloat(t);return Number.isNaN(n)?"":J(n).toString()};function j(e){if(ke(e))return J(e);if(Se(e))return Ee(e);throw TypeError}function Pe({changeImage:e,imageHeight:t,setImageHeight:n,imageWidth:s,setImageWidth:r,pdf:i,setPdf:a,slice:c,unsavedHeight:l,unsavedWidth:f,update:d,cancelUpdate:x,isSlicing:g}){const C=u.useCallback(h=>{a(b=>b&&void 0);const m=O(h.currentTarget.value);n(m||"")},[]),w=u.useCallback(h=>{a(b=>b&&void 0);const m=O(h.currentTarget.value);r(m||"")},[]),p=l||f;return o.jsxs(o.Fragment,{children:[o.jsx(q,{onChange:e}),o.jsx(D,{disabled:p||!!i,loading:g,onClick:c}),o.jsxs(y,{display:"flex",flexGrow:1,flexWrap:"wrap",gap:2,justifyContent:"center",children:[o.jsx(H,{disabled:l,label:"Width",name:"imageWidth",onChange:w,value:s}),o.jsx(H,{disabled:f,label:"Height",name:"imageHeight",onChange:C,value:t})]}),o.jsx(G,{disabled:!p,onCancel:x,onClick:d}),o.jsx($,{fileName:"download",href:i})]})}const Te="modulepreload",Le=function(e){return"/map-slicer/"+e},R={},ot=function(t,n,s){let r=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),a=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));r=Promise.all(n.map(c=>{if(c=Le(c),c in R)return;R[c]=!0;const l=c.endsWith(".css"),f=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${f}`))return;const d=document.createElement("link");if(d.rel=l?"stylesheet":Te,l||(d.as="script",d.crossOrigin=""),d.href=c,a&&d.setAttribute("nonce",a),document.head.appendChild(d),l)return new Promise((x,g)=>{d.addEventListener("load",x),d.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${c}`)))})}))}return r.then(()=>t()).catch(i=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i})},P=.25,Ne="portrait",Y=11,K=8.5,Oe=Y-2*P,Be=K-2*P,We=async({images:e,imageHeight:t,imageWidth:n})=>{const s={orientation:Ne,format:[K,Y],unit:"in"},r="PNG",i=await e;return i.reduce((a,c,l)=>{const f=l+1,d={format:r,imageData:c,x:P,y:P,width:n,height:t};return a.addImage(d),f!==i.length&&a.addPage(s.format,s.orientation),a},new we(s)).output("datauristring")},A=({inches:e,pixelsPerInch:t})=>Math.floor(e*t),E=({pixels:e,pixelsPerInch:t})=>e/t,_e=({inches:e,pixels:t})=>{const n=Math.floor(t/e);return n>0?n:1},z=e=>{const t=parseFloat(e);return Number.isNaN(t)?0:t},T=({pixelsPerInch:e})=>{const t=A({inches:Oe,pixelsPerInch:e});return{sliceHeight:A({inches:Be,pixelsPerInch:e}),sliceWidth:t}};function Fe({image:e,changeImage:t,pdfImages:n,pixelsPerInch:s,setPixelsPerInch:r,onChangePpi:i}){const{sliceHeight:a,sliceWidth:c}=T({pixelsPerInch:s}),l=j(E({pixelsPerInch:s,pixels:e.height}).toString()),f=j(E({pixelsPerInch:s,pixels:e.width}).toString()),d=j(E({pixelsPerInch:s,pixels:a})),x=j(E({pixelsPerInch:s,pixels:c})),[g,C]=u.useState(l),[w,p]=u.useState(f),h=j(g)!==j(l),m=j(w)!==j(f),[b,I]=u.useState(),[Z,B]=u.useState(!1),ee=u.useCallback(()=>{B(!0),setTimeout(async()=>{const k=await We({images:n,imageHeight:d,imageWidth:x});I(k),B(!1)})},[n,d,x]),te=u.useCallback(()=>{const k=({inches:v,pixels:oe})=>{const W=_e({inches:v,pixels:oe});r(_=>_===W?_:(i(),W))};if(m){const v=z(w);k({inches:v,pixels:e.width})}if(h){const v=z(g);k({inches:v,pixels:e.height})}},[e.height,e.width,g,w,h,m]),ne=u.useCallback(()=>{p(f),C(l)},[l,f]);return o.jsx(M,{backgroundImage:`url("${e.src}")`,borderColor:h?"green":b?"blue":"orange",component:"App",header:o.jsx(Pe,{cancelUpdate:ne,changeImage:t,imageHeight:g,imageWidth:w,isSlicing:Z,pdf:b,setImageHeight:C,setImageWidth:p,setPdf:I,slice:ee,unsavedHeight:h,unsavedWidth:m,update:te})})}function He(){return o.jsxs(o.Fragment,{children:[o.jsx(q,{disabled:!0}),o.jsx(D,{disabled:!0}),o.jsx(L,{InputProps:{className:"text-input",endAdornment:o.jsx(N,{position:"end",children:"in"})},autoComplete:"off",disabled:!0,fullWidth:!1,label:"Width",name:"imageWidth",size:"small",type:"text",value:" "}),o.jsx(L,{InputProps:{className:"text-input",endAdornment:o.jsx(N,{position:"end",children:"in"})},autoComplete:"off",disabled:!0,fullWidth:!1,label:"Height",name:"imageHeight",size:"small",type:"text",value:" "}),o.jsx(G,{disabled:!0}),o.jsx($,{disabled:!0})]})}function V(){return o.jsx(M,{borderColor:"orange",component:"EmptyApp",header:o.jsx(He,{}),children:o.jsx(ge,{animation:"wave","data-testid":"Skeleton",height:"100%",variant:"rectangular"})})}const Re=({src:e,onload:t})=>{const n=new Image;return n.src=e,n.onload=t,n};function Q(e){const t=e==null?void 0:e.src,[n,s]=u.useState(t),[r,i]=u.useState(!0),[a,c]=u.useState(null);u.useEffect(()=>{if(i(!0),!n)return;const d=Re({src:n,onload:function(x){var g;i(!1),(g=e==null?void 0:e.onload)==null||g.call(e,x)}});c(d)},[t,n]);const l=u.useCallback(({src:d})=>{s(d)},[]),f=u.useCallback(()=>{c(null)},[]);return{image:r?null:a,isLoading:r,currentImage:a,getImage:l,clearImage:f}}function Ae({sliceHeight:e,sliceWidth:t,image:n}){const s=({sliceSize:a,imageSize:c})=>(a>=c?1:Math.ceil(c/a))*a,r=s({sliceSize:e,imageSize:n.height}),i=s({sliceSize:t,imageSize:n.width});return{height:r,width:i}}async function ze({sliceHeight:e,sliceWidth:t,image:n}){const{height:s,width:r}=Ae({sliceHeight:e,sliceWidth:t,image:n}),i="image/png",a=new OffscreenCanvas(r,s),c=a.getContext("2d");if(c===null)throw Error("[getComposite] null context");c.fillStyle="white",c.fillRect(0,0,a.width,a.height);const l=Math.floor((a.width-n.width)/2),f=Math.floor((a.height-n.height)/2);c.drawImage(n,l,f,n.width,n.height);const d=await a.convertToBlob({type:i});return URL.createObjectURL(d)}async function Ue({sliceHeight:e,sliceWidth:t,image:n,sx:s,sy:r}){const i="image/png",a=new OffscreenCanvas(t,e),c=a.getContext("2d");if(c===null)throw Error("[getCanvas] null context");c.drawImage(n,s,r,t,e,0,0,t,e);const l=await a.convertToBlob({type:i});return URL.createObjectURL(l)}function Me({height:e,width:t,sliceHeight:n,sliceWidth:s}){if(t>s&&t%s!==0)throw Error("[getCoordinates] width out of bounds");if(e>n&&e%n!==0)throw Error("[getCoordinates] height out of bounds");const r=[];for(let i=0;i<e;i+=n)for(let a=0;a<t;a+=s)r.push({sx:a,sy:i});return r}async function $e({image:e,pixelsPerInch:t,callback:n}){const{sliceHeight:s,sliceWidth:r}=T({pixelsPerInch:t}),i=Me({height:e.height,width:e.width,sliceHeight:s,sliceWidth:r}),a=[];for(const{sx:c,sy:l}of i){const f=await Ue({sliceHeight:s,sliceWidth:r,image:e,sx:c,sy:l});n(f),a.push(f)}return a}function De({changeImage:e,image:t}){const[n,s]=u.useState(72),{image:r,getImage:i,clearImage:a}=Q(),[c,l]=u.useState();u.useEffect(()=>{const{sliceHeight:p,sliceWidth:h}=T({pixelsPerInch:n});ze({image:t,sliceHeight:p,sliceWidth:h}).then(m=>{i({src:m})})},[t,n]);const[f,d]=u.useState([]),x=p=>{d(h=>{const m=[...h];return m.push(p),m})},[g,C]=u.useState();u.useEffect(()=>{if(!r)return;const{sliceHeight:p,sliceWidth:h}=T({pixelsPerInch:n}),m=r.height/p,b=r.width/h;C({rows:m,columns:b});const I=$e({image:r,pixelsPerInch:n,callback:x});l(I)},[r,n]);const w=u.useCallback(()=>{a(),l(void 0),d([])},[]);return r&&c?o.jsx(Fe,{changeImage:e,composite:r,grid:g,image:t,onChangePpi:w,pdfImages:c,pixelsPerInch:n,previews:f,setPixelsPerInch:s}):o.jsx(V,{})}const X=(e,t,n,s)=>{u.useRef(e),u.useEffect(()=>{},[e])};function Ge({src:e}){const{image:t,getImage:n}=Q({src:e}),[s,r]=u.useState(),i=({files:c})=>{if(c&&c.length>0){const l=c.item(0);l?r(l):console.warn("unknown error occured during file upload")}else console.warn("file is missing")};u.useEffect(()=>{if(!s)return;const c=URL.createObjectURL(s);n({src:c})},[s]);const a=u.useCallback(c=>{i({files:c.target.files})},[]);return X({image:!!t,src:e,file:!!s}),t?o.jsx(De,{changeImage:a,image:t}):o.jsx(V,{})}const qe="/map-slicer/assets/forest-Bl8z6JIJ.jpg";function Je({children:e}){const[t,n]=u.useState("dark"),s=u.useMemo(()=>pe({palette:{mode:t}}),[t]),r=u.useCallback(()=>n(a=>a==="light"?"dark":"light"),[]),i=u.useMemo(()=>({mode:t,theme:s,toggleMode:r}),[t,s]);return X({children:e,mode:t,theme:s,memo:i}),o.jsx(U.Provider,{value:i,children:o.jsxs(xe,{theme:s,children:[o.jsx(be,{enableColorScheme:!0}),e]})})}function Ye({children:e}){return o.jsx(Je,{children:e})}se(document.getElementById("root")).render(o.jsx(Ye,{children:o.jsx(Ge,{src:qe})}));export{ot as _,tt as a,et as c,nt as g};
