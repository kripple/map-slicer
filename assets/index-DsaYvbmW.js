import{J as a,C as u,L as X}from"./node-modules-yLg8Kcvg.js";import{B as w,d as Z,L as ee,I as te,a as ne,b as oe,c as se,T as re,e as ie,f as ae,g as ce,h as le,i as ue,S as de,j as fe,k as he,C as ge}from"./mui-C0gQmGqE.js";import{E as me}from"./jspdf-DYYcEHdl.js";import"./index-DsaYvbmW.js";import"./emotion-DOaFH67a.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();var Ze=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function et(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function tt(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function s(){return this instanceof s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(s){var o=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(n,s,o.get?o:{enumerable:!0,get:function(){return e[s]}})}),n}function _({color:e}){return a.jsx(w,{bgcolor:e,height:"1px",width:"100vw"})}function pe(){const e=new Date().getFullYear();return a.jsxs(a.Fragment,{children:[a.jsxs(w,{alignItems:"center",display:"flex",gap:1,whiteSpace:"nowrap",children:[a.jsx(Z,{fontSize:"small"})," ",e," Kelly Ripple,"]}),a.jsxs(w,{alignItems:"center",display:"flex",gap:1,whiteSpace:"nowrap",children:[a.jsx(ee,{color:"inherit",href:"https://github.com/twitter/twemoji",target:"_blank",underline:"none",whiteSpace:"nowrap",children:"Favicon by Twemoji"}),a.jsx(te,{"aria-label":"license",color:"inherit",href:"https://creativecommons.org/licenses/by/4.0",size:"small",sx:{padding:0},title:"CC-BY 4.0",children:a.jsx(ne,{fontSize:"small"})})]})]})}const M=u.createContext(void 0),xe=()=>{const e=u.useContext(M);if(!e)throw Error("useThemeContext must be called within a ThemeProvider");return e},be=()=>{const{theme:e}=xe();return e},we=()=>{const e=be(),{primary:t,secondary:n,success:s,info:o,warning:i,error:r,common:c,background:l}=e.palette;return{primary:t.main,secondary:n.main,success:s.main,info:o.main,warning:i.main,error:r.main,white:c.white,black:c.black,background:l.default}};function U({backgroundImage:e,borderColor:t,children:n,component:s,header:o}){const{success:i,info:r,warning:c}=we(),l=t==="green"?i:t==="blue"?r:c;return a.jsxs(w,{alignItems:"center","data-env":"production","data-testid":s,"data-version":"a7f6299164e838af99467c48c320728b2ae89f14",display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",children:[a.jsx(w,{alignItems:"center",component:"header",display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center",p:2,width:"100vw",children:o}),a.jsx(_,{color:l}),a.jsx(w,{className:"main",component:"main",m:1,style:{backgroundImage:e},sx:{backgroundRepeat:"no-repeat",backgroundSize:"contain",backgroundPosition:"center"},children:n}),a.jsx(_,{color:l}),a.jsx(w,{alignItems:"center",className:"footer",color:"gray",component:"footer",display:"flex",flexWrap:"wrap",gap:1,justifyContent:"center",p:2,width:"100vw",children:a.jsx(pe,{})})]})}function v({color:e,component:t,disabled:n,extendedLabel:s,hiddenInput:o,icon:i,label:r,loading:c,newTab:l,...f}){return a.jsxs(oe,{"aria-label":r,className:"header-item",color:e,component:t||(f.onClick?"button":"label"),disabled:n,loading:c,loadingPosition:"start",role:void 0,startIcon:i,sx:{paddingTop:"7px",paddingBottom:"6.5px"},tabIndex:-1,target:l?"_blank":void 0,title:r,variant:"outlined",...f,children:[r,o]})}function je({disabled:e,loading:t,fileName:n,href:s}){const o=()=>{const i=document.createElement("a");n&&(i.download=n),s&&(i.href=s),i.click()};return a.jsx(a.Fragment,{children:a.jsx(v,{color:"info",disabled:e||!s,extendedLabel:"download slices",icon:a.jsx(se,{}),label:"Download",loading:t,onClick:o})})}function R(e){return a.jsx(re,{InputProps:{endAdornment:a.jsx(ie,{position:"end",children:"in"})},autoComplete:"off",className:"header-item",fullWidth:!1,size:"small",tabIndex:0,type:"text",...e})}function ye({disabled:e,loading:t,onClick:n}){return a.jsx(v,{color:"warning",disabled:e,icon:a.jsx(ae,{}),label:"Slice",loading:t,onClick:n})}function Ce({canceling:e,disabled:t,loading:n,onClick:s,onCancel:o}){return a.jsxs(w,{display:"flex",flexGrow:1,flexWrap:"wrap",gap:2,justifyContent:"center",children:[a.jsx(v,{color:"success",disabled:t,icon:a.jsx(ce,{}),label:"Update",loading:n,onClick:s}),a.jsx(v,{color:"error",disabled:t,icon:a.jsx(le,{}),label:"Cancel",loading:e,onClick:o})]})}function Se({disabled:e,loading:t,onChange:n}){return a.jsx(v,{color:"primary",disabled:e,hiddenInput:a.jsx("input",{accept:"image/jpeg,image/png",disabled:e,hidden:!0,onChange:n,type:"file"}),icon:a.jsx(ue,{}),label:"Upload",loading:t})}function ve(e){return typeof e=="string"}function Ie(e){return e!==e}function ke(e){return typeof e=="number"&&!Ie(e)}const O=e=>{const t=[".","0","1","2","3","4","5","6","7","8","9"],n=[];for(const s of e)t.includes(s)&&(n.push(s),s==="."&&t.shift());return n.join("")},z=e=>{const t=Math.abs(e);return t>99999?99999:Math.round(t*100)/100},Ee=e=>{const t=O(e),n=parseFloat(t);return Number.isNaN(n)?"":z(n).toString()};function y(e){if(ke(e))return z(e);if(ve(e))return Ee(e);throw TypeError}function $({changeImage:e,imageHeight:t,setImageHeight:n,imageWidth:s,setImageWidth:o,pdf:i,setPdf:r,slice:c,unsavedHeight:l,unsavedWidth:f,update:d,cancelUpdate:p,isSlicing:m}){const C=u.useCallback(h=>{if(!r||!n)throw Error("[handleChangeHeight] missing required properties");r(b=>b&&void 0);const g=O(h.currentTarget.value);n(g||"")},[r,n]),j=u.useCallback(h=>{if(!r||!o)throw Error("[handleChangeWidth] missing required properties");r(b=>b&&void 0);const g=O(h.currentTarget.value);o(g||"")},[r,o]),x=l||f;return a.jsxs(a.Fragment,{children:[a.jsx(Se,{disabled:!e,onChange:e}),a.jsx(ye,{disabled:!c||x||!!i,loading:m,onClick:c}),a.jsxs(w,{display:"flex",flexGrow:1,flexWrap:"wrap",gap:2,justifyContent:"center",children:[a.jsx(R,{disabled:!r||!o||l,label:"Width",name:"imageWidth",onChange:j,value:s||" "}),a.jsx(R,{disabled:!r||!n||f,label:"Height",name:"imageHeight",onChange:C,value:t||" "})]}),a.jsx(Ce,{disabled:!d||!p||!x,onCancel:p,onClick:d}),a.jsx(je,{disabled:!i,fileName:"download",href:i})]})}const Te="modulepreload",Le=function(e){return"/map-slicer/"+e},W={},nt=function(t,n,s){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),r=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=Promise.all(n.map(c=>{if(c=Le(c),c in W)return;W[c]=!0;const l=c.endsWith(".css"),f=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${f}`))return;const d=document.createElement("link");if(d.rel=l?"stylesheet":Te,l||(d.as="script",d.crossOrigin=""),d.href=c,r&&d.setAttribute("nonce",r),document.head.appendChild(d),l)return new Promise((p,m)=>{d.addEventListener("load",p),d.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}return o.then(()=>t()).catch(i=>{const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=i,window.dispatchEvent(r),!r.defaultPrevented)throw i})},T=.25,Oe="portrait",H=11,D=8.5,Pe=H-2*T,Ne=D-2*T,Be=async({images:e,imageHeight:t,imageWidth:n})=>{const s={orientation:Oe,format:[D,H],unit:"in"},o="PNG",i=await e;return i.reduce((r,c,l)=>{const f=l+1,d={format:o,imageData:c,x:T,y:T,width:n,height:t};return r.addImage(d),f!==i.length&&r.addPage(s.format,s.orientation),r},new me(s)).output("datauristring")},F=({inches:e,pixelsPerInch:t})=>Math.floor(e*t),E=({pixels:e,pixelsPerInch:t})=>e/t,_e=({inches:e,pixels:t})=>{const n=Math.floor(t/e);return n>0?n:1},A=e=>{const t=parseFloat(e);return Number.isNaN(t)?0:t},L=({pixelsPerInch:e})=>{const t=F({inches:Pe,pixelsPerInch:e});return{sliceHeight:F({inches:Ne,pixelsPerInch:e}),sliceWidth:t}};function Re({image:e,changeImage:t,pdfImages:n,pixelsPerInch:s,setPixelsPerInch:o,onChangePpi:i}){const{sliceHeight:r,sliceWidth:c}=L({pixelsPerInch:s}),l=y(E({pixelsPerInch:s,pixels:e.height}).toString()),f=y(E({pixelsPerInch:s,pixels:e.width}).toString()),d=y(E({pixelsPerInch:s,pixels:r})),p=y(E({pixelsPerInch:s,pixels:c})),[m,C]=u.useState(l),[j,x]=u.useState(f),h=y(m)!==y(l),g=y(j)!==y(f),[b,I]=u.useState(),[J,P]=u.useState(!1),Y=u.useCallback(()=>{P(!0),setTimeout(async()=>{const k=await Be({images:n,imageHeight:d,imageWidth:p});I(k),P(!1)})},[n,d,p]),K=u.useCallback(()=>{const k=({inches:S,pixels:Q})=>{const N=_e({inches:S,pixels:Q});o(B=>B===N?B:(i(),N))};if(g){const S=A(j);k({inches:S,pixels:e.width})}if(h){const S=A(m);k({inches:S,pixels:e.height})}},[e.height,e.width,m,j,h,g]),V=u.useCallback(()=>{x(f),C(l)},[l,f]);return a.jsx(U,{backgroundImage:`url("${e.src}")`,borderColor:h?"green":b?"blue":"orange",component:"App",header:a.jsx($,{cancelUpdate:V,changeImage:t,imageHeight:m,imageWidth:j,isSlicing:J,pdf:b,setImageHeight:C,setImageWidth:x,setPdf:I,slice:Y,unsavedHeight:h,unsavedWidth:g,update:K})})}function q(){return a.jsx(U,{borderColor:"orange",component:"EmptyApp",header:a.jsx($,{}),children:a.jsx(de,{animation:"wave","data-testid":"Skeleton",height:"100%",variant:"rectangular"})})}const We=({src:e,onload:t})=>{const n=new Image;return n.src=e,n.onload=t,n};function G(e){const t=e==null?void 0:e.src,[n,s]=u.useState(t),[o,i]=u.useState(!0),[r,c]=u.useState(null);u.useEffect(()=>{if(i(!0),!n)return;const d=We({src:n,onload:function(p){var m;i(!1),(m=e==null?void 0:e.onload)==null||m.call(e,p)}});c(d)},[t,n]);const l=u.useCallback(({src:d})=>{s(d)},[]),f=u.useCallback(()=>{c(null)},[]);return{image:o?null:r,isLoading:o,currentImage:r,getImage:l,clearImage:f}}function Fe({sliceHeight:e,sliceWidth:t,image:n}){const s=({sliceSize:r,imageSize:c})=>(r>=c?1:Math.ceil(c/r))*r,o=s({sliceSize:e,imageSize:n.height}),i=s({sliceSize:t,imageSize:n.width});return{height:o,width:i}}async function Ae({sliceHeight:e,sliceWidth:t,image:n}){const{height:s,width:o}=Fe({sliceHeight:e,sliceWidth:t,image:n}),i="image/png",r=new OffscreenCanvas(o,s),c=r.getContext("2d");if(c===null)throw Error("[getComposite] null context");c.fillStyle="white",c.fillRect(0,0,r.width,r.height);const l=Math.floor((r.width-n.width)/2),f=Math.floor((r.height-n.height)/2);c.drawImage(n,l,f,n.width,n.height);const d=await r.convertToBlob({type:i});return URL.createObjectURL(d)}async function Me({sliceHeight:e,sliceWidth:t,image:n,sx:s,sy:o}){const i="image/png",r=new OffscreenCanvas(t,e),c=r.getContext("2d");if(c===null)throw Error("[getCanvas] null context");c.drawImage(n,s,o,t,e,0,0,t,e);const l=await r.convertToBlob({type:i});return URL.createObjectURL(l)}function Ue({height:e,width:t,sliceHeight:n,sliceWidth:s}){if(t>s&&t%s!==0)throw Error("[getCoordinates] width out of bounds");if(e>n&&e%n!==0)throw Error("[getCoordinates] height out of bounds");const o=[];for(let i=0;i<e;i+=n)for(let r=0;r<t;r+=s)o.push({sx:r,sy:i});return o}async function ze({image:e,pixelsPerInch:t,callback:n}){const{sliceHeight:s,sliceWidth:o}=L({pixelsPerInch:t}),i=Ue({height:e.height,width:e.width,sliceHeight:s,sliceWidth:o}),r=[];for(const{sx:c,sy:l}of i){const f=await Me({sliceHeight:s,sliceWidth:o,image:e,sx:c,sy:l});n(f),r.push(f)}return r}function $e({changeImage:e,image:t}){const[n,s]=u.useState(72),{image:o,getImage:i,clearImage:r}=G(),[c,l]=u.useState();u.useEffect(()=>{const{sliceHeight:x,sliceWidth:h}=L({pixelsPerInch:n});Ae({image:t,sliceHeight:x,sliceWidth:h}).then(g=>{i({src:g})})},[t,n]);const[f,d]=u.useState([]),p=x=>{d(h=>{const g=[...h];return g.push(x),g})},[m,C]=u.useState();u.useEffect(()=>{if(!o)return;const{sliceHeight:x,sliceWidth:h}=L({pixelsPerInch:n}),g=o.height/x,b=o.width/h;C({rows:g,columns:b});const I=ze({image:o,pixelsPerInch:n,callback:p});l(I)},[o,n]);const j=u.useCallback(()=>{r(),l(void 0),d([])},[]);return o&&c?a.jsx(Re,{changeImage:e,composite:o,grid:m,image:t,onChangePpi:j,pdfImages:c,pixelsPerInch:n,previews:f,setPixelsPerInch:s}):a.jsx(q,{})}function He({src:e}){const{image:t,getImage:n}=G({src:e}),[s,o]=u.useState(),i=({files:c})=>{if(c&&c.length>0){const l=c.item(0);l?o(l):console.warn("unknown error occured during file upload")}else console.warn("file is missing")};u.useEffect(()=>{if(!s)return;const c=URL.createObjectURL(s);n({src:c})},[s]);const r=u.useCallback(c=>{i({files:c.target.files})},[]);return t?a.jsx($e,{changeImage:r,image:t}):a.jsx(q,{})}const De="/map-slicer/assets/forest-Bl8z6JIJ.jpg",qe=(e,t,n,s)=>{u.useRef(e),u.useEffect(()=>{},[e])};function Ge({children:e}){const[t,n]=u.useState("dark"),s=u.useMemo(()=>fe({palette:{mode:t}}),[t]),o=u.useCallback(()=>n(r=>r==="light"?"dark":"light"),[]),i=u.useMemo(()=>({mode:t,theme:s,toggleMode:o}),[t,s]);return qe({children:e,mode:t,theme:s,memo:i}),a.jsx(M.Provider,{value:i,children:a.jsxs(he,{theme:s,children:[a.jsx(ge,{enableColorScheme:!0}),e]})})}function Je({children:e}){return a.jsx(Ge,{children:e})}X(document.getElementById("root")).render(a.jsx(Je,{children:a.jsx(He,{src:De})}));export{nt as _,et as a,Ze as c,tt as g};
