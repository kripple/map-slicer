import{J as r,C as l,L as F,N as re}from"./node-modules-RfLiduRQ.js";import{B as m,d as ae,L as ce,I as le,a as ue,u as de,b as he,c as fe,T as ge,e as pe,f as me,g as A,h as xe,i as we,j as ye,k as K,l as be,m as je,n as Ce,C as ve,S as Ie,o as Se,p as Pe,q as Ee}from"./mui-DdlOHblq.js";import{E as We}from"./jspdf-Z6jsRF1l.js";import"./index-Bk5fDODu.js";import"./emotion-B189cwYW.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();var xt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function yt(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var o=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(n,i,o.get?o:{enumerable:!0,get:function(){return e[i]}})}),n}function D({color:e}){return r.jsx(m,{bgcolor:e,height:"1px",width:"100vw"})}function Te(){const e=new Date().getFullYear();return r.jsxs(r.Fragment,{children:[r.jsxs(m,{alignItems:"center",display:"flex",gap:1,whiteSpace:"nowrap",children:[r.jsx(ae,{fontSize:"small"})," ",e," Kelly Ripple,"]}),r.jsxs(m,{alignItems:"center",display:"flex",gap:1,whiteSpace:"nowrap",children:[r.jsx(ce,{color:"inherit",href:"https://github.com/twitter/twemoji",tabIndex:-1,target:"_blank",underline:"none",whiteSpace:"nowrap",children:"Favicon by Twemoji"}),r.jsx(le,{"aria-label":"license",color:"inherit",href:"https://creativecommons.org/licenses/by/4.0",size:"small",sx:{padding:0},tabIndex:-1,title:"CC-BY 4.0",children:r.jsx(ue,{fontSize:"small"})})]})]})}const V=l.createContext(void 0),ke=()=>{const e=l.useContext(V);if(!e)throw Error("useThemeContext must be called within a ThemeProvider");return e},Oe=()=>{const{theme:e}=ke();return e},Le=()=>{const e=Oe(),{primary:t,secondary:n,success:i,info:o,warning:s,error:a,common:c,background:u}=e.palette;return{primary:t.main,secondary:n.main,success:i.main,info:o.main,warning:s.main,error:a.main,white:c.white,black:c.black,background:u.default}};function Q({borderColor:e,children:t,component:n,header:i}){const{success:o,info:s,warning:a}=Le(),c=e==="green"?o:e==="blue"?s:a;return r.jsxs(m,{alignItems:"center","data-env":"production","data-testid":n,"data-version":"92bafa372f106395fa444cff5e673eee7e2d4869",display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",children:[r.jsx(m,{alignItems:"center",component:"header",display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center",p:2,width:"100%",children:i}),r.jsx(D,{color:c}),r.jsx(m,{alignItems:"center",component:"main",display:"flex",flexGrow:1,justifyContent:"center",p:2,width:"100%",children:t}),r.jsx(D,{color:c}),r.jsx(m,{alignItems:"center",className:"footer",color:"gray",component:"footer",display:"flex",flexWrap:"wrap",gap:1,justifyContent:"center",p:2,width:"100vw",children:r.jsx(Te,{})})]})}function B(){return de("(max-width:500px)")}function T({color:e,component:t,disabled:n,hiddenInput:i,icon:o,label:s,loading:a,newTab:c,tabIndex:u=0,iconButton:h,defaultSize:d,...g}){const f=B(),p={width:f?void 0:"144px"},w={display:"flex",flexGrow:1,paddingTop:"7px",paddingBottom:"6.5px"};return r.jsxs(he,{"aria-label":s,color:e,component:t||(g.onClick?"button":"label"),disabled:n,fullWidth:f,loading:a,loadingPosition:h?"center":"start",role:void 0,startIcon:h?void 0:o,style:d?p:void 0,sx:w,tabIndex:u,target:c?"_blank":void 0,title:s,variant:"outlined",...g,children:[h?o:s,i]})}function He({disabled:e,loading:t,fileName:n,href:i}){const o=l.useCallback(()=>{const s=document.createElement("a");n&&(s.download=n),i&&(s.href=i),s.click()},[n,i]);return r.jsx(T,{color:"info",defaultSize:!0,disabled:e||!i,icon:r.jsx(fe,{}),label:"Download",loading:t,onClick:o})}function q(e){const t={display:"flex",flexGrow:1};return r.jsx(ge,{InputProps:{endAdornment:r.jsx(pe,{position:"end",children:"in"})},autoComplete:"off",fullWidth:!1,size:"small",sx:t,tabIndex:-1,type:"text",...e})}const X=l.createContext(void 0),_=()=>{const e=l.useContext(X);if(!e)throw Error("usePageContext must be called within a PageProvider");return e},$e=({orientation:e,pageMargin:t})=>{if(e==="portrait")return{pageHeight:11,pageWidth:8.5,sliceWidthInches:8.5-2*t,sliceHeightInches:11-2*t};if(e==="landscape")return{pageHeight:8.5,pageWidth:11,sliceWidthInches:11-2*t,sliceHeightInches:8.5-2*t};throw TypeError("[getOrientation] invalid orientation type")},G=()=>{const{orientation:e,pageMargin:t}=_(),{pageHeight:n,pageWidth:i,sliceWidthInches:o,sliceHeightInches:s}=$e({orientation:e,pageMargin:t});return{orientation:e,pageHeight:n,pageWidth:i,sliceWidthInches:o,sliceHeightInches:s}},Be=()=>{const{setOrientation:e}=_();return e},Z=()=>{const{pageMargin:e}=_();return e};function Me(){const{orientation:e}=G(),t=Be(),n=B(),i={display:"flex",flexGrow:1};return r.jsxs(me,{"aria-label":"text alignment",exclusive:!0,fullWidth:n,size:"small",sx:i,value:e,children:[r.jsx(A,{"aria-label":"portrait",onClick:t,sx:i,tabIndex:0,title:"Portrait",value:"portrait",children:r.jsx(xe,{})}),r.jsx(A,{"aria-label":"landscape",onClick:t,sx:i,tabIndex:0,title:"Landscape",value:"landscape",children:r.jsx(we,{})})]})}function Re({disabled:e,loading:t,onClick:n}){return r.jsx(T,{color:"warning",defaultSize:!0,disabled:e,icon:r.jsx(ye,{}),label:"Slice",loading:t,onClick:n})}function _e({canceling:e,disabled:t,loading:n,onClick:i,onCancel:o}){const s=B(),a={display:"flex",flexGrow:1};return r.jsxs(K,{fullWidth:s,sx:a,children:[r.jsx(T,{color:"success",disabled:t,icon:r.jsx(be,{}),iconButton:!0,label:"Update",loading:n,onClick:i}),r.jsx(T,{color:"error",disabled:t,icon:r.jsx(je,{}),iconButton:!0,label:"Cancel",loading:e,onClick:o})]})}function Ge({disabled:e,loading:t,onChange:n}){return r.jsx(T,{color:"primary",defaultSize:!0,disabled:e,hiddenInput:r.jsx("input",{accept:"image/jpeg,image/png",disabled:e,hidden:!0,onChange:n,type:"file"}),icon:r.jsx(Ce,{}),label:"Upload",loading:t})}function Ne(e){return typeof e=="string"}function Ue(e){return e!==e}function ze(e){return typeof e=="number"&&!Ue(e)}const R=e=>{const t=[".","0","1","2","3","4","5","6","7","8","9"],n=[];for(const i of e)t.includes(i)&&(n.push(i),i==="."&&t.shift());return n.join("")},ee=e=>{const t=Math.abs(e);return t>99999?99999:Math.round(t*100)/100},Fe=e=>{const t=R(e),n=parseFloat(t);return Number.isNaN(n)?"":ee(n).toString()};function I(e){if(ze(e))return ee(e);if(Ne(e))return Fe(e);throw TypeError}function te({changeImage:e,imageHeight:t,setImageHeight:n,imageWidth:i,setImageWidth:o,pdf:s,setPdf:a,slice:c,unsavedHeight:u,unsavedWidth:h,update:d,cancelUpdate:g,isSlicing:f}){const p=B(),w=l.useCallback(C=>{if(!a||!n)throw Error("[handleChangeHeight] missing required properties");a(x=>x&&void 0);const b=R(C.currentTarget.value);n(b||"")},[a,n]),j=l.useCallback(C=>{if(!a||!o)throw Error("[handleChangeWidth] missing required properties");a(x=>x&&void 0);const b=R(C.currentTarget.value);o(b||"")},[a,o]),y=u||h;return r.jsxs(r.Fragment,{children:[r.jsxs(K,{fullWidth:p?!0:void 0,orientation:p?"vertical":"horizontal",sx:{display:"flex",flexGrow:1,justifyContent:"center"},children:[r.jsx(Ge,{disabled:!e,onChange:e}),r.jsx(Re,{disabled:!c||y||!!s,loading:f,onClick:c}),r.jsx(He,{disabled:!s,fileName:"download",href:s})]}),r.jsxs(m,{display:"flex",flexDirection:p?"column":"row",flexGrow:1,flexWrap:"nowrap",gap:2,justifyContent:"center",children:[r.jsx(q,{disabled:!a||!o||u,label:"Width",name:"imageWidth",onChange:j,value:i||" "}),r.jsx(q,{disabled:!a||!n||h,label:"Height",name:"imageHeight",onChange:w,value:t||" "}),r.jsxs(m,{display:"flex",flexGrow:1,gap:2,children:[r.jsx(_e,{disabled:!d||!g||!y,onCancel:g,onClick:d}),r.jsx(Me,{})]})]})]})}function Ae({grid:e,previews:t}){const{height:n,ref:i}=F({handleHeight:!0,handleWidth:!1}),{width:o,ref:s}=F({handleHeight:!1,handleWidth:!0});if(!e||!t)return null;const a=e.columns*e.rows,c=t.concat(Array(a-t.length).fill("placeholder")),u=4,h=n&&o?Math.min(o/((e.columnWidth+u)*e.columns),n/((e.rowHeight+u)*e.rows)):void 0;return r.jsxs(m,{"data-testid":"Previews",display:"flex",flexDirection:"column",height:"100%",position:"relative",width:"100%",children:[r.jsx(m,{"data-testid":"Width",height:"0",ref:s,width:"100%"}),r.jsx(m,{"data-testid":"Height",height:"100%",ref:i,width:"0"}),r.jsx(m,{alignContent:"center",bottom:"0","data-testid":"Grid",display:"grid",gridTemplateColumns:`repeat(${e.columns}, ${h?`${h*e.columnWidth}px`:"auto"})`,gridTemplateRows:`repeat(${e.rows}, ${h?`${h*e.rowHeight}px`:"auto"})`,justifyContent:"center",left:"0",position:"absolute",right:"0",top:"0",children:c.map((d,g)=>{const f=d==="placeholder",p=`${u/2}px`;return r.jsx(m,{"data-testid":"GridItem",position:"relative",children:r.jsx(ve,{image:d,style:{position:"absolute",top:p,bottom:p,left:p,right:p}})},f?`${d}-${g}`:d)})})]})}const De="modulepreload",qe=function(e){return"/map-slicer/"+e},J={},bt=function(t,n,i){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));o=Promise.all(n.map(c=>{if(c=qe(c),c in J)return;J[c]=!0;const u=c.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":De,u||(d.as="script",d.crossOrigin=""),d.href=c,a&&d.setAttribute("nonce",a),document.head.appendChild(d),u)return new Promise((g,f)=>{d.addEventListener("load",g),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${c}`)))})}))}return o.then(()=>t()).catch(s=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s})},Je=async({images:e,imageHeight:t,imageWidth:n,orientation:i,pageHeight:o,pageWidth:s})=>{const a={orientation:i,format:[s,o],unit:"in"},c="PNG",u=await e;return u.reduce((h,d,g)=>{const f=g+1,p={format:c,imageData:d,x:0,y:0,width:n,height:t};return h.addImage(p),f!==u.length&&h.addPage(a.format,a.orientation),h},new We(a)).output("datauristring")},P=({inches:e,pixelsPerInch:t})=>Math.floor(e*t),$=({pixels:e,pixelsPerInch:t})=>e/t,Ye=({inches:e,pixels:t})=>{const n=Math.floor(t/e);return n>0?n:1},Y=e=>{const t=parseFloat(e);return Number.isNaN(t)?0:t};function Ke({image:e,composite:t,changeImage:n,pdfImages:i,pixelsPerInch:o,setPixelsPerInch:s,onChangePpi:a,previews:c}){const u=Z(),{orientation:h,sliceHeightInches:d,sliceWidthInches:g}=G(),f=I($({pixelsPerInch:o,pixels:t.grid.rowHeight})),p=I($({pixelsPerInch:o,pixels:t.grid.columnWidth})),w=I($({pixelsPerInch:o,pixels:e.height}).toString()),j=I($({pixelsPerInch:o,pixels:e.width}).toString()),[y,C]=l.useState(w),[b,x]=l.useState(j),v=I(y)!==I(w),S=I(b)!==I(j),[k,O]=l.useState(),[M,L]=l.useState(!1),H=l.useCallback(()=>{if(!i)throw Error("[slice] missing required properties");L(!0),setTimeout(async()=>{const E=await Je({images:i,imageHeight:f,imageWidth:p,pageHeight:d,pageWidth:g,orientation:h});O(E),L(!1)})},[u,i,f,p]),oe=l.useCallback(()=>{const E=({inches:W,pixels:ie})=>{const U=Ye({inches:W,pixels:ie});s(z=>z===U?z:(a(),U))};if(S){const W=Y(b);E({inches:W,pixels:e.width})}if(v){const W=Y(y);E({inches:W,pixels:e.height})}},[e.height,e.width,y,b,v,S]),se=l.useCallback(()=>{x(j),C(w)},[w,j]),N=E=>`url("${E}")`;return r.jsx(Q,{backgroundImage:N(t?t.image.src:e.src),borderColor:v?"green":k?"blue":"orange",component:"App",header:r.jsx(te,{cancelUpdate:se,changeImage:n,imageHeight:y,imageWidth:b,isSlicing:M,pdf:k,setImageHeight:C,setImageWidth:x,setPdf:O,slice:i?H:void 0,unsavedHeight:v,unsavedWidth:S,update:oe}),children:r.jsx(Ae,{grid:t.grid,previews:c})})}function Ve(){return r.jsx(Q,{borderColor:"orange",component:"EmptyApp",header:r.jsx(te,{}),children:r.jsx(Ie,{animation:"wave","data-testid":"Skeleton",height:"100%",variant:"rectangular"})})}const Qe=({src:e,onload:t})=>{const n=new Image;return n.src=e,n.onload=t,n};function ne(e){const t=e==null?void 0:e.src,[n,i]=l.useState(t),[o,s]=l.useState(!0),[a,c]=l.useState(null);l.useEffect(()=>{if(s(!0),!n)return;const d=Qe({src:n,onload:function(g){var f;s(!1),(f=e==null?void 0:e.onload)==null||f.call(e,g)}});c(d)},[t,n]);const u=l.useCallback(({src:d})=>{i(d)},[]),h=l.useCallback(()=>{c(null)},[]);return{image:o?null:a,isLoading:o,currentImage:a,getImage:u,clearImage:h}}function Xe({sliceHeight:e,sliceWidth:t,image:n}){const i=({sliceSize:a,imageSize:c})=>(a>=c?1:Math.ceil(c/a))*a,o=i({sliceSize:e,imageSize:n.height}),s=i({sliceSize:t,imageSize:n.width});return{height:o,width:s}}async function Ze({image:e,height:t,width:n}){const i="image/png",o=new OffscreenCanvas(n,t),s=o.getContext("2d");if(s===null)throw Error("[getCompositeUrl] null context");s.fillStyle="white",s.fillRect(0,0,o.width,o.height);const a=Math.floor((o.width-e.width)/2),c=Math.floor((o.height-e.height)/2);s.drawImage(e,a,c,e.width,e.height);const u=await o.convertToBlob({type:i});return URL.createObjectURL(u)}async function et({image:e,height:t,width:n,sx:i,sy:o,margin:s}){const a="image/png",c=s*2,u=new OffscreenCanvas(n+c,t+c),h=u.getContext("2d");if(h===null)throw Error("[getCanvas] null context");h.fillStyle="white",h.fillRect(0,0,u.width,u.height),h.drawImage(e,i,o,n,t,s,s,n,t);const d=await u.convertToBlob({type:a});return URL.createObjectURL(d)}async function tt({sliceHeight:e,sliceWidth:t,image:n}){const{height:i,width:o}=Xe({sliceHeight:e,sliceWidth:t,image:n});return Ze({height:i,width:o,image:n})}const nt=({rowHeight:e,columnWidth:t,totalHeight:n,totalWidth:i})=>{if(i%t!==0)throw Error("[useGrid] width out of bounds");if(n%e!==0)throw Error("[useGrid] height out of bounds");const o=i/t,s=n/e;return{columns:o,rows:s,columnWidth:t,rowHeight:e}};function ot({height:e,width:t,sliceHeight:n,sliceWidth:i}){if(t>i&&t%i!==0)throw Error("[getCoordinates] width out of bounds");if(e>n&&e%n!==0)throw Error("[getCoordinates] height out of bounds");const o=[];for(let s=0;s<e;s+=n)for(let a=0;a<t;a+=i)o.push({sx:a,sy:s});return o}async function st({image:e,pixelsPerInch:t,pageMargin:n,sliceHeightInches:i,sliceWidthInches:o,callback:s}){const a=P({inches:o,pixelsPerInch:t}),c=P({inches:i,pixelsPerInch:t}),u=ot({height:e.height,width:e.width,sliceHeight:c,sliceWidth:a}),h=[];for(const{sx:d,sy:g}of u){const f=await et({height:c,width:a,image:e,sx:d,sy:g,margin:n});s==null||s(f),h.push(f)}return h}function it({changeImage:e,image:t}){const{sliceHeightInches:n,sliceWidthInches:i}=G(),[o,s]=l.useState(72),{image:a,getImage:c,clearImage:u}=ne(),[h,d]=l.useState(),[g,f]=l.useState();l.useEffect(()=>{if(!t)return;const x=P({inches:i,pixelsPerInch:o}),v=P({inches:n,pixelsPerInch:o});u(),d(void 0),f(void 0),y([]),tt({image:t,sliceHeight:v,sliceWidth:x}).then(S=>{c({src:S})})},[t,o,n,i]);const p=Z(),w=P({inches:p,pixelsPerInch:o}),[j,y]=l.useState([]);l.useEffect(()=>{if(!a)return;const x=M=>{y(L=>{const H=[...L];return H.push(M),H})},v=P({inches:i,pixelsPerInch:o}),S=P({inches:n,pixelsPerInch:o}),k=st({image:a,pixelsPerInch:o,callback:x,pageMargin:w,sliceHeightInches:n,sliceWidthInches:i});d(k);const O=nt({rowHeight:S,columnWidth:v,totalHeight:a.height,totalWidth:a.width});f(O)},[a,o,p,w]);const C=l.useCallback(()=>{u(),d(void 0),f(void 0),y([])},[]),b=l.useMemo(()=>a&&g?{image:a,grid:g}:void 0,[a,g]);return t&&b&&h?r.jsx(Ke,{changeImage:e,composite:b,image:t,onChangePpi:C,pdfImages:h,pixelsPerInch:o,previews:j,setPixelsPerInch:s}):r.jsx(Ve,{})}function rt({src:e}){const{image:t,getImage:n}=ne({src:e}),[i,o]=l.useState(),s=({files:c})=>{if(c&&c.length>0){const u=c.item(0);u?o(u):console.warn("unknown error occured during file upload")}else console.warn("file is missing")};l.useEffect(()=>{if(!i)return;const c=URL.createObjectURL(i);n({src:c})},[i]);const a=l.useCallback(c=>{s({files:c.target.files})},[]);return r.jsx(it,{changeImage:a,image:t})}const at="/map-slicer/assets/forest-Bl8z6JIJ.jpg",ct=(e,t,n,i)=>{l.useRef(e),l.useEffect(()=>{},[e])};function lt({children:e}){const[t,n]=l.useState("dark"),i=l.useMemo(()=>Se({palette:{mode:t}}),[t]),o=l.useCallback(()=>n(a=>a==="light"?"dark":"light"),[]),s=l.useMemo(()=>({mode:t,theme:i,toggleMode:o}),[t,i]);return ct({children:e,mode:t,theme:i,memo:s}),r.jsx(V.Provider,{value:s,children:r.jsxs(Pe,{theme:i,children:[r.jsx(Ee,{enableColorScheme:!0}),e]})})}function ut({children:e}){const[t,n]=l.useState("portrait"),i=l.useCallback(s=>{const a=s.currentTarget.value==="portrait"?"portrait":"landscape";n(c=>c===a?c:a)},[]),o=l.useMemo(()=>({orientation:t,setOrientation:i,pageMargin:.25}),[t]);return r.jsx(X.Provider,{value:o,children:e})}function dt({children:e}){return r.jsx(lt,{children:r.jsx(ut,{children:e})})}re(document.getElementById("root")).render(r.jsx(dt,{children:r.jsx(rt,{src:at})}));export{bt as _,wt as a,xt as c,yt as g};
