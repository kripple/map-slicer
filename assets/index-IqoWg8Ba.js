import{J as o,C as a,L as Ue,N as Ge}from"./node-modules-D1Hv2pYF.js";import{B as b,d as Be,L as Le,I as Ce,a as Ne,D as De,b as _e,c as Ae,e as Fe,f as qe,u as Je,g as Ye,h as Ke,i as Qe,T as Ve,j as Xe,k as ye,l as Ze,m as et,n as We,o as tt,p as nt,q as it,C as rt,r as st,s as ot,t as at,v as ct}from"./mui-CBire2em.js";import{E as lt}from"./jspdf-Bc9hBJcL.js";import"./index-IqoWg8Ba.js";import"./emotion-ogtPlaTZ.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();var sn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function on(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function an(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function s(){return this instanceof s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(s){var r=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(n,s,r.get?r:{enumerable:!0,get:function(){return e[s]}})}),n}function je({color:e}){return o.jsx(b,{bgcolor:e,height:"1px",width:"100vw"})}function me({description:e,keyValue:t}){return o.jsxs(b,{display:"flex",flexDirection:"row",children:[o.jsx(b,{sx:{minWidth:"32px"},children:o.jsx(Be,{style:{height:"8px"}})}),o.jsx(b,{display:"inline-flex",flexWrap:"wrap",gap:.5,children:e.map((n,s)=>o.jsx(b,{ml:"punctuation"in n?-.5:0,children:"link"in n?o.jsx(Le,{href:n.link,tabIndex:-1,target:"_blank",underline:"none",whiteSpace:"nowrap",children:n.text}):n.text},`${t}-${s}`))})]})}function ut(){return o.jsxs(b,{"data-testid":"Attributions",display:"flex",flexDirection:"column",gap:1.5,children:[o.jsx(me,{description:[{text:"Favicon"},{text:"by"},{text:"Twemoji",link:"https://github.com/twitter/twemoji"},{text:",",punctuation:!0},{text:"licensed"},{text:"under"},{text:"the"},{text:"CC-BY 4.0",link:"https://creativecommons.org/licenses/by/4.0"},{text:".",punctuation:!0}],keyValue:"twemoji"}),o.jsx(me,{description:[{text:"Forest"},{text:"map"},{text:"by"},{text:"Rune Foundry",link:"https://runefoundry.com/"},{text:".",punctuation:!0}],keyValue:"runefoundry"}),o.jsx(me,{description:[{text:"Built"},{text:"with"},{text:"React",link:"https://react.dev/"},{text:",",punctuation:!0},{text:"Vite",link:"https://vitejs.dev/"},{text:",",punctuation:!0},{text:"and"},{text:"Material UI",link:"https://mui.com/material-ui/"},{text:".",punctuation:!0}],keyValue:"runefoundry"})]})}const dt={divider:"rgba(255, 255, 255, 0.36)",grid:"rgba(255, 255, 255, 0.12)",gray:"rgb(158, 158, 158)"},Me=a.createContext(void 0),He=()=>{const e=a.useContext(Me);if(!e)throw Error("useThemeContext must be called within a ThemeProvider");return e},gt=()=>{const{theme:e}=He();return e},be=()=>{const e=gt(),{colors:t}=He(),{primary:n,secondary:s,success:r,info:i,warning:c,error:l,background:m}=e.palette;return{primary:n.main,secondary:s.main,success:r.main,info:i.main,warning:c.main,error:l.main,background:m.default,...t}};function mt(){const{gray:e}=be(),[t,n]=a.useState(!1),s=a.useCallback(()=>{n(!0)},[]),r=a.useCallback(()=>{n(!1)},[]);return o.jsxs(b,{"data-testid":"AttributionsModal",p:0,children:[o.jsx(Ce,{color:"inherit",onClick:s,size:"small",style:{padding:0},tabIndex:-1,children:o.jsx(Ne,{fontSize:"small"})}),o.jsxs(De,{"aria-labelledby":"dialog-title",onClose:r,open:t,children:[o.jsxs(_e,{sx:{display:"flex",justifyContent:"space-between",p:2},children:["Attributions",o.jsx(Ce,{"aria-label":"close",onClick:r,size:"medium",style:{padding:0,color:e,height:"32px",width:"32px"},children:o.jsx(Ae,{fontSize:"medium"})})]}),o.jsx(Fe,{sx:{p:2},children:o.jsx(ut,{})})]})]})}function ht(){const e=new Date().getFullYear();return o.jsxs(b,{alignItems:"center",className:"footer",color:"gray",component:"footer",display:"flex",flexWrap:"wrap",gap:1,justifyContent:"space-between",p:2,width:"100%",children:[o.jsxs(b,{alignItems:"center",display:"flex",gap:1,whiteSpace:"nowrap",children:[o.jsx(qe,{fontSize:"small"})," ",e," Kelly Ripple"]}),o.jsx(b,{alignItems:"center",display:"flex",gap:1,whiteSpace:"nowrap",children:o.jsx(mt,{})})]})}function ae(){return Je("(max-width:750px)")}function re({color:e,component:t,testId:n,disabled:s,hiddenInput:r,icon:i,label:c,loading:l,newTab:m,tabIndex:d=0,iconButton:g,type:h="button",maxWidth:f,...P}){const I=ae(),C={display:"flex",flexGrow:1,minHeight:"40px",whiteSpace:"nowrap"},M=g?{paddingLeft:"9px",paddingRight:"9px",minWidth:"unset"}:{},y="rgba(255, 255, 255, 0.12)",W=e?C:{...C,...M,borderBottomColor:y,borderLeftColor:y,borderRightColor:y,borderTopColor:y},S=s===!0?{disabled:s}:{};return o.jsxs(Ye,{"aria-label":c,color:e||"inherit",component:t||(P.onClick?"button":"label"),"data-testid":n||"Button",fullWidth:I,loading:l,loadingPosition:"center",role:void 0,startIcon:g?void 0:i,style:W,tabIndex:d,target:m?"_blank":void 0,title:c,type:h,variant:"outlined",...P,...S,children:[g?i:c,r]})}function pt({disabled:e,loading:t,onClick:n}){return o.jsx(re,{color:"secondary",disabled:e,icon:o.jsx(Ke,{}),label:"Download",loading:t,onClick:n})}function J({units:e="inches",style:t,readOnly:n,...s}){const r=a.useMemo(()=>({InputProps:{endAdornment:e==="inches"?o.jsx(Qe,{position:"end",children:"in"}):void 0,readOnly:n}}),[e,n]);return o.jsx(Ve,{autoComplete:"off",fullWidth:!1,size:"small",style:{display:"flex",flexGrow:1,...t},tabIndex:-1,type:"text",...r,...s})}function ft(e){const t=ae(),[n,s]=a.useState(e.orientation||"portrait");a.useEffect(()=>{e.orientation&&s(e.orientation)},[e.orientation]);const r={display:"flex",flexGrow:1},i=a.useCallback(c=>{if(!e.setOrientation||!("value"in c.currentTarget))throw Error("[handleClick] missing required properties");const l=c.currentTarget.value;e.setOrientation(l==="portrait"?"portrait":"landscape")},[e.setOrientation]);return o.jsxs(Xe,{"aria-label":"text alignment",disabled:!s,fullWidth:t,size:"small",style:r,value:n,children:[o.jsx(ye,{"aria-label":"portrait",onClick:i,style:r,tabIndex:0,title:"Portrait",value:"portrait",children:o.jsx(Ze,{})}),o.jsx(ye,{"aria-label":"landscape",onClick:i,style:r,tabIndex:0,title:"Landscape",value:"landscape",children:o.jsx(et,{})})]})}function xt({canceling:e,disabled:t,loading:n,onCancel:s}){const r=ae(),i={display:"flex",flexGrow:1};return o.jsxs(We,{fullWidth:r,style:i,children:[o.jsx(re,{color:"success",component:"button",disabled:t,icon:o.jsx(tt,{}),iconButton:!0,label:"Apply Changes",loading:n,testId:"SubmitButton",type:"submit"}),o.jsx(re,{color:"primary",disabled:!s,icon:o.jsx(nt,{}),iconButton:!0,label:"Undo Changes",loading:e,onClick:s})]})}function bt({disabled:e,loading:t,onChange:n}){return o.jsx(re,{color:"info",disabled:e,hiddenInput:o.jsx("input",{accept:"image/jpeg,image/png",disabled:e,hidden:!0,onChange:n,type:"file"}),icon:o.jsx(it,{}),label:"Upload",loading:t})}function Y(e){const[t,n]=a.useState(e),s=a.useCallback(r=>{n(r)},[]);return a.useEffect(()=>{n(e)},[e]),[t,s]}const ke=a.createContext(void 0),Te=()=>{const e=a.useContext(ke);if(!e)throw Error("useStatusContext must be called within a StatusProvider");return e},Pt=()=>{const{isUpdating:e,setIsUpdating:t}=Te();return[e,t]},wt=()=>{const{isToggling:e,setIsToggling:t}=Te();return[e,t]},Ct=e=>{if(e==="isUpdating")return Pt;if(e==="isToggling")return wt;throw console.debug(`[useStatus] unsupported status '${e}'`),Error("[useStatus] unsupported status")},pe=e=>Ct(e)();function yt(e){return typeof e=="string"}function jt(e){return e!==e}function Z(e){return typeof e=="number"&&!jt(e)}const L=(e,t={integer:!1})=>{const n=[".","0","1","2","3","4","5","6","7","8","9"];t.integer&&n.shift();const s=[];for(const r of e)n.includes(r)&&(s.push(r),r==="."&&n.shift());return s.join("")},Ee=(e,t={integer:!1})=>{const n=Math.abs(e);return n>99999?99999:t!=null&&t.integer?Math.ceil(n):Math.round(n*100)/100},vt=(e,t={integer:!1})=>{const n=L(e),s=parseFloat(n);return Number.isNaN(s)?"":Ee(s,t).toString()};function k(e,t={integer:!1}){if(Z(e))return Ee(e,t);if(yt(e))return vt(e,t);throw TypeError}const fe=e=>`${e.toFixed(2)}px`,z=(e,t)=>{if(t&&t.minimum&&t.maximum&&t.minimum>t.maximum)throw Error(`[getNumber] minimum value '${t.minimum}' is greater than maximum value '${t.maximum}'`);const n=Z(t==null?void 0:t.minimum)?t.minimum:0,s=Z(t==null?void 0:t.maximum)?t.maximum:void 0,r=parseFloat(e);return Z(r)?s===void 0?Math.max(n,r):Math.min(Math.max(n,r),s):n};function K(e,t,n={integer:!1}){const s=Z(e)?e.toString():e;return t===""||(t&&s?k(t,{integer:n.integer})!==k(s,{integer:n.integer}):!1)}const he=({inches:e,pixelsPerInch:t})=>Math.floor(e*t),Q=({pixels:e,pixelsPerInch:t})=>e/t,ve=({inches:e,pixels:t})=>{const n=Math.floor(t/e);return n>0?n:1},Se=1,se=2.5,oe=100,St=({imageHeight:e,imageHeightPixels:t,imageWidth:n,imageWidthPixels:s})=>{const c=e>=n?t:s,l=Math.max(Math.ceil(c/100),1);return{minimumPixelsPerInch:l,maximumImageHeight:k(Q({pixelsPerInch:l,pixels:t})),maximumImageWidth:k(Q({pixelsPerInch:l,pixels:s}))}},Re=({height:e,width:t})=>{const n=Math.min(e,t);return k(n/4)};function It({changeImage:e,image:t,download:n,update:s,orientation:r,...i}){const c=ae(),[l,m]=pe("isToggling"),[d,g]=Y(i.imageHeight),[h,f]=Y(i.imageWidth),[P,I]=Y(i.pageHeight.toString()),[C,M]=Y(i.pageWidth.toString()),[y,W]=Y(i.pageMargin.toString()),[S,U]=Y(i.pixelsPerInch.toString()),O=a.useCallback(w=>{const v=L(w.currentTarget.value);g(v||" ")},[]),N=a.useCallback(w=>{const v=L(w.currentTarget.value);f(v||" ")},[]),$=a.useCallback(w=>{const v=L(w.currentTarget.value);I(v||" ")},[]),D=a.useCallback(w=>{const v=L(w.currentTarget.value);M(v||" ")},[]),G=a.useCallback(w=>{const v=L(w.currentTarget.value);W(v||" ")},[]),_=a.useCallback(w=>{const v=L(w.currentTarget.value,{integer:!0});U(v||" ")},[]),B=K(i.imageHeight,d),T=K(i.imageWidth,h),ce=K(i.pageHeight,P),le=K(i.pageWidth,C),ue=K(i.pageMargin,y),A=K(i.pixelsPerInch,S,{integer:!0}),x=(B||T||ce||le||ue||A)&&!l,F=a.useCallback(w=>{if(w.preventDefault(),!t||!s)throw Error("[handleUpdate] missing required properties");const v=z(d,{minimum:Se}),te=z(h,{minimum:Se}),{minimumPixelsPerInch:ge,maximumImageHeight:ne,maximumImageWidth:ie}=St({imageHeight:v,imageHeightPixels:t.height,imageWidth:te,imageWidthPixels:t.width}),p=B?ve({inches:Math.min(v,ne),pixels:t.height}):T?ve({inches:Math.min(te,ie),pixels:t.width}):z(S,{minimum:ge}),u=z(P,{minimum:se,maximum:oe}),j=z(C,{minimum:se,maximum:oe}),R=Re({width:j,height:u}),V=z(y,{maximum:R}),Pe=Q({pixels:t.height,pixelsPerInch:p}),H=Q({pixels:t.width,pixelsPerInch:p});s({imageHeight:k(Pe.toString()),imageWidth:k(H.toString()),pageHeight:u,pageWidth:j,pageMargin:V,pixelsPerInch:p,orientation:r}),E()},[d,h,P,C,y,S,r,s]),E=a.useCallback(()=>{g(i.imageHeight),f(i.imageWidth),I(i.pageHeight.toString()),M(i.pageWidth.toString()),W(i.pageMargin.toString()),U(i.pixelsPerInch.toString())},[i.imageHeight,i.imageWidth,i.pageHeight,i.pageWidth,i.pageMargin,i.pixelsPerInch]),ee=a.useCallback(w=>{if(!s)throw Error("[handleSetOrientation] missing required properties");w!==r&&(m(!0),s({imageHeight:i.imageHeight,imageWidth:i.imageWidth,pageHeight:i.pageWidth,pageWidth:i.pageHeight,pageMargin:i.pageMargin,pixelsPerInch:i.pixelsPerInch,orientation:w}),E())},[i.imageHeight,i.imageWidth,i.pageHeight,i.pageWidth,i.pageMargin,i.pixelsPerInch,r,s]);return o.jsxs(b,{alignItems:"center",component:"header","data-testid":"Header",display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center",p:2,position:"relative",width:"100%",children:[o.jsxs(We,{orientation:"horizontal",style:{flexGrow:1,justifyContent:"center",display:"grid",gridTemplateColumns:"repeat(2, 1fr)"},children:[o.jsx(bt,{disabled:!e,onChange:e}),o.jsx(pt,{disabled:!n||x,onClick:n})]}),o.jsx("form",{autoComplete:"off",noValidate:!0,onSubmit:F,style:{display:"flex",flexGrow:1},children:o.jsxs(b,{display:"flex",flexGrow:1,flexWrap:"wrap",gap:2,children:[o.jsxs(b,{display:"flex",flexGrow:1,gap:2,children:[o.jsx(J,{disabled:B||A,label:"Width",name:"imageWidth",onChange:N,value:h||" "}),o.jsx(J,{disabled:T||A,label:"Height",name:"imageHeight",onChange:O,value:d||" "})]}),o.jsx(J,{disabled:B||T,label:"DPI",name:"pixelsPerInch",onChange:_,style:{display:c?"none":"flex"},units:"none",value:S.toString()}),o.jsx(J,{label:"Print Margin",name:"pageMargin",onChange:G,style:{display:c?"none":"flex"},value:y.toString()}),o.jsxs(b,{display:c?"none":"flex",flexGrow:1,gap:2,children:[o.jsx(J,{label:"Paper Width",name:"pageWidth",onChange:D,style:{display:c?"none":"flex"},value:C}),o.jsx(J,{label:"Paper Height",name:"pageHeight",onChange:$,style:{display:c?"none":"flex"},value:P})]}),o.jsx(ft,{orientation:r,setOrientation:s?ee:void 0}),o.jsx(xt,{disabled:!x,onCancel:x?E:void 0})]})})]})}function Wt({margin:e,src:t}){return t?o.jsx(rt,{image:t,style:{position:"absolute",top:e,bottom:e,left:e,right:e,animationName:"appear",animationDuration:"200ms",animationIterationCount:1,animationTimingFunction:"ease-in"}}):null}function Mt({composite:{previews:e,props:{columnCount:t,rowCount:n,pageCount:s,screenPadding:r,screenGridHeight:i,screenGridWidth:c}}}){const[l,m]=a.useState(Array(s).fill({src:void 0}));return a.useEffect(()=>{const d=e.concat(Array(s-e.length).fill({src:void 0}));m(d)},[e,s]),o.jsx(b,{alignContent:"center",bottom:"0",display:"grid",gridTemplateColumns:`repeat(${t}, ${fe(c)})`,gridTemplateRows:`repeat(${n}, ${fe(i)})`,justifyContent:"center",left:"0",position:"absolute",right:"0",top:"0",children:l.map(({src:d,pageNumber:g},h)=>{const f=`${r/2}px`;return o.jsx(b,{position:"relative",children:o.jsx(Wt,{margin:f,src:d})},d?`page-${g}`:`placeholder-${h}`)})})}function Ht({screenSizeRef:e}){return o.jsx(b,{height:"100%",position:"absolute",ref:e,width:"100%"})}const ze=e=>{const t=a.useRef(!0);a.useEffect(()=>{t.current&&(t.current=!1,e())},[])};function kt(){const{gray:e}=be(),t=a.useRef(),[n,s]=a.useState(!1);return ze(()=>(t.current=setTimeout(()=>{s(!0)},1e3),()=>{t.current&&clearTimeout(t.current)})),n?o.jsx(b,{alignContent:"center",alignItems:"center",bottom:"0",display:"flex",justifyContent:"center",left:"0",position:"absolute",right:"0",top:"0",children:o.jsx(st,{sx:{color:e,height:"66%",width:"66%",animation:"spin 3s linear infinite"}})}):null}function Tt({props:e,previews:t,screenSizeRef:n}){return o.jsxs(b,{"data-testid":"Previews",display:"flex",flexDirection:"column",height:"100%",position:"relative",width:"100%",children:[o.jsx(Ht,{screenSizeRef:n}),e?o.jsx(Mt,{composite:{previews:t||[],props:e}}):o.jsx(kt,{})]})}const Et={useResizeDetector:Ue},Oe=a.createContext(void 0),Rt=()=>{const e=a.useContext(Oe);if(!e)throw Error("useParamsContext must be called within a ParamsProvider");return e},zt="production",Ot="439dd6410e6888ec826fdb4ecc9590a3122e4e37",$t=({image:e,compositeHeight:t,compositeWidth:n})=>{if(t===0||n===0)throw Error("[getCompositeUrlPromise] dimensions are invalid");const s="image/png",r=new OffscreenCanvas(n,t),i=r.getContext("2d");if(i===null)throw Error("[getCompositeUrlPromise] null context");i.fillStyle="white",i.fillRect(0,0,r.width,r.height);const c=Math.floor((r.width-e.width)/2),l=Math.floor((r.height-e.height)/2);return i.drawImage(e,c,l,e.width,e.height),r.convertToBlob({type:s}).then(d=>URL.createObjectURL(d))},Ut=({src:e,onload:t})=>{const n=new Image;return n.src=e,t&&(n.onload=t),n},xe=({src:e})=>new Promise(t=>{const n=Ut({src:e,onload:function(){t(n)}})}),Gt=({image:e,pageImageHeight:t,pageImageWidth:n})=>{const s=({size:h,imageSize:f})=>h>=f?1:Math.ceil(f/h),r=s({size:n,imageSize:e.width}),i=s({size:t,imageSize:e.height}),c=t*i,l=n*r,m=[];let d=1;for(let h=0;h<c;h+=t)for(let f=0;f<l;f+=n)m.push({sx:f,sy:h,pageNumber:d}),d+=1;return{compositeHeight:c,compositeWidth:l,rowCount:i,columnCount:r,pageCount:i*r,coordinates:m}},Bt=({screenHeight:e,screenWidth:t,columnCount:n,rowCount:s,pageHeight:r,pageWidth:i,pageHeightInches:c,pageWidthInches:l})=>{const d=t/n-4,g=e/s-4,h=d/i,f=g/r,P=Math.min(h,f),I=P*i,C=P*r,M=I+4,y=C+4,W=d/l,S=g/c;return{screenSpacing:Math.min(W,S),screenPadding:4,screenGridHeight:y,screenGridWidth:M}};function Lt({image:e,pageHeight:t,pageWidth:n,pageMargin:s,pixelsPerInch:r,screenHeight:i,screenWidth:c,resize:l}){const m=he({inches:t,pixelsPerInch:r}),d=he({inches:n,pixelsPerInch:r}),g=he({inches:s,pixelsPerInch:r}),h=2*g,f=m-h,P=d-h,I=Q({pixels:f,pixelsPerInch:r}),C=Q({pixels:P,pixelsPerInch:r}),{compositeHeight:M,compositeWidth:y,rowCount:W,columnCount:S,pageCount:U,coordinates:O}=Gt({image:e,pageImageHeight:f,pageImageWidth:P}),{screenSpacing:N,screenPadding:$,screenGridHeight:D,screenGridWidth:G}=Bt({screenHeight:i,screenWidth:c,pageHeight:m,pageWidth:d,columnCount:S,rowCount:W,pageHeightInches:t,pageWidthInches:n});return l?{screenSpacing:N,screenPadding:$,screenGridHeight:D,screenGridWidth:G}:$t({compositeHeight:M,compositeWidth:y,image:e}).then(_=>xe({src:_}).then(T=>({id:T.src,composite:T,rowCount:W,columnCount:S,pageCount:U,coordinates:O,pageHeight:m,pageWidth:d,pageMargin:g,pageHeightInches:t,pageWidthInches:n,pageMarginInches:s,pageImageHeight:f,pageImageWidth:P,pageImageHeightInches:I,pageImageWidthInches:C,screenSpacing:N,screenPadding:$,screenGridHeight:D,screenGridWidth:G})))}const Nt=({id:e,composite:t,height:n,width:s,sx:r,sy:i,margin:c,pageNumber:l,pageCount:m})=>{if(n===0||s===0)throw Error("[getPagePromise] dimensions are invalid");const d="image/png",g=c*2,h=new OffscreenCanvas(s+g,n+g),f=h.getContext("2d");if(f===null)throw Error("[getPagePromise] null context");return f.fillStyle="white",f.fillRect(0,0,h.width,h.height),f.drawImage(t,r,i,s,n,c,c,s,n),h.convertToBlob({type:d}).then(I=>({src:URL.createObjectURL(I),pageNumber:l,pageCount:m,id:e}))},Dt="modulepreload",_t=function(e){return"/map-slicer/"+e},Ie={},cn=function(t,n,s){let r=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),c=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));r=Promise.all(n.map(l=>{if(l=_t(l),l in Ie)return;Ie[l]=!0;const m=l.endsWith(".css"),d=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const g=document.createElement("link");if(g.rel=m?"stylesheet":Dt,m||(g.as="script",g.crossOrigin=""),g.href=l,c&&g.setAttribute("nonce",c),document.head.appendChild(g),m)return new Promise((h,f)=>{g.addEventListener("load",h),g.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}return r.then(()=>t()).catch(i=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i})},At=({images:e,height:t,width:n})=>{const s={orientation:n>t?"landscape":"portrait",format:[n,t],unit:"in"},r="PNG";return e.reduce((i,c,l)=>{const m=l+1,d={format:r,imageData:c,x:0,y:0,width:n,height:t};return i.addImage(d),m!==e.length&&i.addPage(s.format,s.orientation),i},new lt(s)).output("datauristring")};function Ft({changeImage:e,image:t}){var ne,ie;const n=a.useCallback(Lt,[]),s=a.useCallback(Nt,[]),[,r]=pe("isUpdating"),[,i]=pe("isToggling"),c=a.useRef(),l=a.useCallback(p=>new Promise((u,j)=>{if(p.id!==c.current)j("id mismatch");else{const R=s(p);u({promise:R,reject:j})}}),[]),m=Rt(),d=be(),{height:g,width:h,ref:f}=Et.useResizeDetector({refreshMode:"throttle",refreshRate:50}),P=a.useRef(),I=a.useRef(!0),[C,M]=a.useState();a.useEffect(()=>{if(!g||!h)return;if(I.current){I.current=!1,M({screenHeight:g,screenWidth:h});return}if(!P.current)return;const p=n({...P.current,screenHeight:g,screenWidth:h,resize:!0});A(p.screenSpacing),F(u=>!u.image||!u.previews||!u.props?u:{...u,props:{...u.props,screenPadding:p.screenPadding,screenGridHeight:p.screenGridHeight,screenGridWidth:p.screenGridWidth}})},[g,h]);const[y,W]=a.useState(m.pageMargin),[S,U]=a.useState(m.pageHeight),[O,N]=a.useState(m.pageWidth),[$,D]=a.useState(72),[G,_]=a.useState(m.orientation),[B,T]=a.useState("16"),[ce,le]=a.useState("23"),[ue,A]=a.useState(0),de=fe(ue),[x,F]=a.useState({}),E=a.useRef(),ee=a.useCallback(p=>{p.id===c.current&&F(u=>{const j=u.previews?[...u.previews]:[];return j.push(p),{...u,previews:j}})},[]);a.useEffect(()=>{if(!t||!C)return;const p={image:t,pageMargin:y,pageHeight:S,pageWidth:O,pixelsPerInch:$,screenHeight:C.screenHeight,screenWidth:C.screenWidth};P.current=p,w(),n(p).then(u=>{c.current=u.composite.src,A(u.screenSpacing),F({image:u.composite,props:{columnCount:u.columnCount,rowCount:u.rowCount,pageCount:u.pageCount,screenPadding:u.screenPadding,screenGridHeight:u.screenGridHeight,screenGridWidth:u.screenGridWidth}}),E.current={height:u.pageImageHeightInches,width:u.pageImageWidthInches};const j=[];for(const[H,{sx:X,sy:q}]of u.coordinates.entries())j.push({id:u.id,height:u.pageImageHeight,width:u.pageImageWidth,composite:u.composite,sx:X,sy:q,margin:u.pageMargin,pageNumber:H+1,pageCount:u.pageCount});const R=j.shift();if(!R)return;const V=l(R);j.reduce((H,X)=>H.then(({promise:q,reject:$e})=>q.then(we=>(we.id!==c.current?$e("id mismatch"):ee(we),l(X)))),V).then(({promise:H,reject:X})=>H.then(q=>{q.id!==c.current?X("id mismatch"):(ee(q),r(!1),i(!1))})).catch(H=>{H!=="id mismatch"&&console.warn(H)})}).catch(u=>{u!=="id mismatch"&&console.warn(u)})},[t,S,O,y,$,G,C]);const w=a.useCallback(()=>{F({}),c.current=void 0},[]),v=a.useCallback(p=>{T(p.imageHeight),le(p.imageWidth),W(p.pageMargin),U(p.pageHeight),N(p.pageWidth),D(p.pixelsPerInch),_(p.orientation)},[]),te=E.current&&x.previews&&((ne=x.props)==null?void 0:ne.pageCount)&&x.props.pageCount===x.previews.length,ge=a.useCallback(()=>{var p;if(!(E.current&&x.previews&&((p=x.props)!=null&&p.pageCount)&&x.props.pageCount===x.previews.length))throw Error("[createPdf] missing required properties");setTimeout(async()=>{var R;if(!(E.current&&x.previews&&((R=x.props)!=null&&R.pageCount)&&x.props.pageCount===x.previews.length))throw Error("[createPdf] missing required properties");const u=At({...E.current,images:x.previews.map(V=>V.src)}),j=document.createElement("a");j.download="download",j.href=u,j.click()})},[x.previews,(ie=x.props)==null?void 0:ie.pageCount]);return o.jsxs(b,{alignItems:"center","data-env":zt,"data-testid":"App","data-version":Ot,display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",children:[o.jsx(It,{changeImage:e,download:te?ge:void 0,image:t,imageHeight:B,imageWidth:ce,orientation:G,pageHeight:S,pageMargin:y,pageWidth:O,pixelsPerInch:$,update:t?v:void 0}),o.jsx(je,{color:d.divider}),o.jsx(b,{alignItems:"center",boxSizing:"border-box",component:"main",display:"flex",flexGrow:1,justifyContent:"center",p:2,position:"relative",style:{transition:"background-size 2s ease-out",backgroundSize:`${de} ${de}`,backgroundImage:`linear-gradient(to right, ${d.grid} 1px, transparent 1px), linear-gradient(to bottom, ${d.grid} 1px, transparent 1px)`,backgroundPosition:"center"},width:"100%",children:o.jsx(Tt,{previews:x.previews,props:x.props,screenSizeRef:f})}),o.jsx(je,{color:d.divider}),o.jsx(ht,{})]})}function qt({children:e}){const t=a.useMemo(()=>{const n=new URLSearchParams(window.location.search),s=k(z(n.get("paperHeight")||"11",{minimum:se,maximum:oe})),r=k(z(n.get("paperWidth")||"8.5",{minimum:se,maximum:oe})),i=Re({height:s,width:r}),c=k(z(n.get("printMargin")||"0.25",{maximum:i})),l=n.get("orientation")==="landscape"?"landscape":"portrait";return{pageHeight:s,pageWidth:r,pageMargin:c,orientation:l}},[]);return o.jsx(Oe.Provider,{value:t,children:e})}function Jt({src:e}){const[t,n]=a.useState(null);ze(()=>{xe({src:e}).then(r=>{n(r)})});const s=a.useCallback(r=>{(({files:c})=>{if(c&&c.length>0){const l=c.item(0);if(l){const m=URL.createObjectURL(l);xe({src:m}).then(d=>{n(d)})}else console.warn("[ImageLoader] unknown error occured during file upload")}else console.warn("[ImageLoader] file is missing")})({files:r.target.files})},[]);return o.jsx(qt,{image:t,children:o.jsx(Ft,{changeImage:s,image:t})})}const Yt="/map-slicer/assets/forest-Bl8z6JIJ.jpg",Kt=(e,t,n,s)=>{a.useRef(e),a.useEffect(()=>{},[e])};function Qt({children:e}){const[t,n]=a.useState("dark"),s=a.useMemo(()=>ot({components:{MuiButtonBase:{defaultProps:{focusRipple:!1}}},palette:{mode:t}}),[t]),r=a.useCallback(()=>n(c=>c==="light"?"dark":"light"),[]),i=a.useMemo(()=>({colors:dt,mode:t,theme:s,toggleMode:r}),[t,s]);return Kt({children:e,mode:t,theme:s,memo:i}),o.jsx(Me.Provider,{value:i,children:o.jsxs(at,{theme:s,children:[o.jsx(ct,{enableColorScheme:!0}),e]})})}function Vt({children:e}){const[t,n]=a.useState(!1),[s,r]=a.useState(!1),i=a.useMemo(()=>({isUpdating:t,setIsUpdating:c=>n(c),isToggling:s,setIsToggling:c=>r(c)}),[t,s]);return o.jsx(ke.Provider,{value:i,children:e})}function Xt({children:e}){return o.jsx(Qt,{children:o.jsx(Vt,{children:e})})}Ge(document.getElementById("root")).render(o.jsx(Xt,{children:o.jsx(Jt,{src:Yt})}));export{cn as _,on as a,sn as c,an as g};
