import{J as i,C as l,L as A,N as se}from"./node-modules-DK-fcTeY.js";import{B as p,d as re,L as ie,I as ae,a as ce,b as le,c as ue,T as de,e as he,f as ge,g as G,h as fe,i as me,j as pe,k as xe,l as we,m as be,C as je,S as ye,n as Ce,o as ve,p as Ie}from"./mui-CLUeF7us.js";import{E as Se}from"./jspdf-2W-AnNjd.js";import"./index-DdrJwPc_.js";import"./emotion-BtAKTy1u.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();var ft=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function pt(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var o=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,o.get?o:{enumerable:!0,get:function(){return e[r]}})}),n}function z({color:e}){return i.jsx(p,{bgcolor:e,height:"1px",width:"100vw"})}function Ee(){const e=new Date().getFullYear();return i.jsxs(i.Fragment,{children:[i.jsxs(p,{alignItems:"center",display:"flex",gap:1,whiteSpace:"nowrap",children:[i.jsx(re,{fontSize:"small"})," ",e," Kelly Ripple,"]}),i.jsxs(p,{alignItems:"center",display:"flex",gap:1,whiteSpace:"nowrap",children:[i.jsx(ie,{color:"inherit",href:"https://github.com/twitter/twemoji",target:"_blank",underline:"none",whiteSpace:"nowrap",children:"Favicon by Twemoji"}),i.jsx(ae,{"aria-label":"license",color:"inherit",href:"https://creativecommons.org/licenses/by/4.0",size:"small",sx:{padding:0},title:"CC-BY 4.0",children:i.jsx(ce,{fontSize:"small"})})]})]})}const Y=l.createContext(void 0),Pe=()=>{const e=l.useContext(Y);if(!e)throw Error("useThemeContext must be called within a ThemeProvider");return e},Te=()=>{const{theme:e}=Pe();return e},Oe=()=>{const e=Te(),{primary:t,secondary:n,success:r,info:o,warning:s,error:a,common:c,background:u}=e.palette;return{primary:t.main,secondary:n.main,success:r.main,info:o.main,warning:s.main,error:a.main,white:c.white,black:c.black,background:u.default}};function K({borderColor:e,children:t,component:n,header:r}){const{success:o,info:s,warning:a}=Oe(),c=e==="green"?o:e==="blue"?s:a;return i.jsxs(p,{alignItems:"center","data-env":"production","data-testid":n,"data-version":"7899fa511d21e5628946967ba77a5ef167ae6334",display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",children:[i.jsx(p,{alignItems:"center",component:"header",display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center",p:2,width:"100%",children:r}),i.jsx(z,{color:c}),i.jsx(p,{alignItems:"center",component:"main",display:"flex",flexGrow:1,justifyContent:"center",p:2,width:"100%",children:t}),i.jsx(z,{color:c}),i.jsx(p,{alignItems:"center",className:"footer",color:"gray",component:"footer",display:"flex",flexWrap:"wrap",gap:1,justifyContent:"center",p:2,width:"100vw",children:i.jsx(Ee,{})})]})}function O({color:e,component:t,disabled:n,extendedLabel:r,hiddenInput:o,icon:s,label:a,loading:c,newTab:u,...d}){return i.jsxs(le,{"aria-label":a,className:"header-item",color:e,component:t||(d.onClick?"button":"label"),disabled:n,loading:c,loadingPosition:"start",role:void 0,startIcon:s,sx:{paddingTop:"7px",paddingBottom:"6.5px"},tabIndex:-1,target:u?"_blank":void 0,title:a,variant:"outlined",...d,children:[a,o]})}function We({disabled:e,loading:t,fileName:n,href:r}){const o=()=>{const s=document.createElement("a");n&&(s.download=n),r&&(s.href=r),s.click()};return i.jsx(i.Fragment,{children:i.jsx(O,{color:"info",disabled:e||!r,extendedLabel:"download slices",icon:i.jsx(ue,{}),label:"Download",loading:t,onClick:o})})}function D(e){return i.jsx(de,{InputProps:{endAdornment:i.jsx(he,{position:"end",children:"in"})},autoComplete:"off",className:"header-item",fullWidth:!1,size:"small",tabIndex:0,type:"text",...e})}const V=l.createContext(void 0),M=()=>{const e=l.useContext(V);if(!e)throw Error("usePageContext must be called within a PageProvider");return e},ke=({orientation:e,pageMargin:t})=>{if(e==="portrait")return{pageHeight:11,pageWidth:8.5,sliceWidthInches:8.5-2*t,sliceHeightInches:11-2*t};if(e==="landscape")return{pageHeight:8.5,pageWidth:11,sliceWidthInches:11-2*t,sliceHeightInches:8.5-2*t};throw TypeError("[getOrientation] invalid orientation type")},R=()=>{const{orientation:e,pageMargin:t}=M(),{pageHeight:n,pageWidth:r,sliceWidthInches:o,sliceHeightInches:s}=ke({orientation:e,pageMargin:t});return{orientation:e,pageHeight:n,pageWidth:r,sliceWidthInches:o,sliceHeightInches:s}},He=()=>{const{setOrientation:e}=M();return e},Q=()=>{const{pageMargin:e}=M();return e};function Le(){const{orientation:e}=R(),t=He();return i.jsxs(ge,{"aria-label":"text alignment",exclusive:!0,size:"small",value:e,children:[i.jsx(G,{"aria-label":"portrait",onClick:t,value:"portrait",children:i.jsx(fe,{})}),i.jsx(G,{"aria-label":"landscape",onClick:t,value:"landscape",children:i.jsx(me,{})})]})}function $e({disabled:e,loading:t,onClick:n}){return i.jsx(O,{color:"warning",disabled:e,icon:i.jsx(pe,{}),label:"Slice",loading:t,onClick:n})}function Be({canceling:e,disabled:t,loading:n,onClick:r,onCancel:o}){return i.jsxs(p,{display:"flex",flexGrow:1,flexWrap:"wrap",gap:2,justifyContent:"center",children:[i.jsx(O,{color:"success",disabled:t,icon:i.jsx(xe,{}),label:"Update",loading:n,onClick:r}),i.jsx(O,{color:"error",disabled:t,icon:i.jsx(we,{}),label:"Cancel",loading:e,onClick:o})]})}function Ne({disabled:e,loading:t,onChange:n}){return i.jsx(O,{color:"primary",disabled:e,hiddenInput:i.jsx("input",{accept:"image/jpeg,image/png",disabled:e,hidden:!0,onChange:n,type:"file"}),icon:i.jsx(be,{}),label:"Upload",loading:t})}function Me(e){return typeof e=="string"}function Re(e){return e!==e}function _e(e){return typeof e=="number"&&!Re(e)}const N=e=>{const t=[".","0","1","2","3","4","5","6","7","8","9"],n=[];for(const r of e)t.includes(r)&&(n.push(r),r==="."&&t.shift());return n.join("")},X=e=>{const t=Math.abs(e);return t>99999?99999:Math.round(t*100)/100},Fe=e=>{const t=N(e),n=parseFloat(t);return Number.isNaN(n)?"":X(n).toString()};function v(e){if(_e(e))return X(e);if(Me(e))return Fe(e);throw TypeError}function Z({changeImage:e,imageHeight:t,setImageHeight:n,imageWidth:r,setImageWidth:o,pdf:s,setPdf:a,slice:c,unsavedHeight:u,unsavedWidth:d,update:h,cancelUpdate:f,isSlicing:g}){const m=l.useCallback(w=>{if(!a||!n)throw Error("[handleChangeHeight] missing required properties");a(x=>x&&void 0);const y=N(w.currentTarget.value);n(y||"")},[a,n]),b=l.useCallback(w=>{if(!a||!o)throw Error("[handleChangeWidth] missing required properties");a(x=>x&&void 0);const y=N(w.currentTarget.value);o(y||"")},[a,o]),j=u||d;return i.jsxs(i.Fragment,{children:[i.jsx(Ne,{disabled:!e,onChange:e}),i.jsx($e,{disabled:!c||j||!!s,loading:g,onClick:c}),i.jsxs(p,{display:"flex",flexGrow:1,flexWrap:"wrap",gap:2,justifyContent:"center",children:[i.jsx(D,{disabled:!a||!o||u,label:"Width",name:"imageWidth",onChange:b,value:r||" "}),i.jsx(D,{disabled:!a||!n||d,label:"Height",name:"imageHeight",onChange:m,value:t||" "})]}),i.jsx(Be,{disabled:!h||!f||!j,onCancel:f,onClick:h}),i.jsx(We,{disabled:!s,fileName:"download",href:s}),i.jsx(Le,{})]})}function Ue({grid:e,previews:t}){const{height:n,ref:r}=A({handleHeight:!0,handleWidth:!1}),{width:o,ref:s}=A({handleHeight:!1,handleWidth:!0});if(!e||!t)return null;const a=e.columns*e.rows,c=t.concat(Array(a-t.length).fill("placeholder")),u=4,d=n&&o?Math.min(o/((e.columnWidth+u)*e.columns),n/((e.rowHeight+u)*e.rows)):void 0;return i.jsxs(p,{"data-testid":"Previews",display:"flex",flexDirection:"column",height:"100%",position:"relative",width:"100%",children:[i.jsx(p,{"data-testid":"Width",height:"0",ref:s,width:"100%"}),i.jsx(p,{"data-testid":"Height",height:"100%",ref:r,width:"0"}),i.jsx(p,{alignContent:"center",bottom:"0","data-testid":"Grid",display:"grid",gridTemplateColumns:`repeat(${e.columns}, ${d?`${d*e.columnWidth}px`:"auto"})`,gridTemplateRows:`repeat(${e.rows}, ${d?`${d*e.rowHeight}px`:"auto"})`,justifyContent:"center",left:"0",position:"absolute",right:"0",top:"0",children:c.map((h,f)=>{const g=h==="placeholder",m=`${u/2}px`;return i.jsx(p,{"data-testid":"GridItem",position:"relative",children:i.jsx(je,{image:h,style:{position:"absolute",top:m,bottom:m,left:m,right:m}})},g?`${h}-${f}`:h)})})]})}const Ae="modulepreload",Ge=function(e){return"/map-slicer/"+e},q={},xt=function(t,n,r){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));o=Promise.all(n.map(c=>{if(c=Ge(c),c in q)return;q[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":Ae,u||(h.as="script",h.crossOrigin=""),h.href=c,a&&h.setAttribute("nonce",a),document.head.appendChild(h),u)return new Promise((f,g)=>{h.addEventListener("load",f),h.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${c}`)))})}))}return o.then(()=>t()).catch(s=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s})},ze=async({images:e,imageHeight:t,imageWidth:n,orientation:r,pageHeight:o,pageWidth:s})=>{const a={orientation:r,format:[s,o],unit:"in"},c="PNG",u=await e;return u.reduce((d,h,f)=>{const g=f+1,m={format:c,imageData:h,x:0,y:0,width:n,height:t};return d.addImage(m),g!==u.length&&d.addPage(a.format,a.orientation),d},new Se(a)).output("datauristring")},S=({inches:e,pixelsPerInch:t})=>Math.floor(e*t),$=({pixels:e,pixelsPerInch:t})=>e/t,De=({inches:e,pixels:t})=>{const n=Math.floor(t/e);return n>0?n:1},J=e=>{const t=parseFloat(e);return Number.isNaN(t)?0:t};function qe({image:e,composite:t,changeImage:n,pdfImages:r,pixelsPerInch:o,setPixelsPerInch:s,onChangePpi:a,previews:c}){const u=Q(),{orientation:d,sliceHeightInches:h,sliceWidthInches:f}=R(),g=v($({pixelsPerInch:o,pixels:t.grid.rowHeight})),m=v($({pixelsPerInch:o,pixels:t.grid.columnWidth})),b=v($({pixelsPerInch:o,pixels:e.height}).toString()),j=v($({pixelsPerInch:o,pixels:e.width}).toString()),[w,y]=l.useState(b),[x,E]=l.useState(j),C=v(w)!==v(b),I=v(x)!==v(j),[W,k]=l.useState(),[B,H]=l.useState(!1),L=l.useCallback(()=>{if(!r)throw Error("[slice] missing required properties");H(!0),setTimeout(async()=>{const P=await ze({images:r,imageHeight:g,imageWidth:m,pageHeight:h,pageWidth:f,orientation:d});k(P),H(!1)})},[u,r,g,m]),te=l.useCallback(()=>{const P=({inches:T,pixels:oe})=>{const F=De({inches:T,pixels:oe});s(U=>U===F?U:(a(),F))};if(I){const T=J(x);P({inches:T,pixels:e.width})}if(C){const T=J(w);P({inches:T,pixels:e.height})}},[e.height,e.width,w,x,C,I]),ne=l.useCallback(()=>{E(j),y(b)},[b,j]),_=P=>`url("${P}")`;return i.jsx(K,{backgroundImage:_(t?t.image.src:e.src),borderColor:C?"green":W?"blue":"orange",component:"App",header:i.jsx(Z,{cancelUpdate:ne,changeImage:n,imageHeight:w,imageWidth:x,isSlicing:B,pdf:W,setImageHeight:y,setImageWidth:E,setPdf:k,slice:r?L:void 0,unsavedHeight:C,unsavedWidth:I,update:te}),children:i.jsx(Ue,{grid:t.grid,previews:c})})}function Je(){return i.jsx(K,{borderColor:"orange",component:"EmptyApp",header:i.jsx(Z,{}),children:i.jsx(ye,{animation:"wave","data-testid":"Skeleton",height:"100%",variant:"rectangular"})})}const Ye=({src:e,onload:t})=>{const n=new Image;return n.src=e,n.onload=t,n};function ee(e){const t=e==null?void 0:e.src,[n,r]=l.useState(t),[o,s]=l.useState(!0),[a,c]=l.useState(null);l.useEffect(()=>{if(s(!0),!n)return;const h=Ye({src:n,onload:function(f){var g;s(!1),(g=e==null?void 0:e.onload)==null||g.call(e,f)}});c(h)},[t,n]);const u=l.useCallback(({src:h})=>{r(h)},[]),d=l.useCallback(()=>{c(null)},[]);return{image:o?null:a,isLoading:o,currentImage:a,getImage:u,clearImage:d}}function Ke({sliceHeight:e,sliceWidth:t,image:n}){const r=({sliceSize:a,imageSize:c})=>(a>=c?1:Math.ceil(c/a))*a,o=r({sliceSize:e,imageSize:n.height}),s=r({sliceSize:t,imageSize:n.width});return{height:o,width:s}}async function Ve({image:e,height:t,width:n}){const r="image/png",o=new OffscreenCanvas(n,t),s=o.getContext("2d");if(s===null)throw Error("[getCompositeUrl] null context");s.fillStyle="white",s.fillRect(0,0,o.width,o.height);const a=Math.floor((o.width-e.width)/2),c=Math.floor((o.height-e.height)/2);s.drawImage(e,a,c,e.width,e.height);const u=await o.convertToBlob({type:r});return URL.createObjectURL(u)}async function Qe({image:e,height:t,width:n,sx:r,sy:o,margin:s}){const a="image/png",c=s*2,u=new OffscreenCanvas(n+c,t+c),d=u.getContext("2d");if(d===null)throw Error("[getCanvas] null context");d.fillStyle="white",d.fillRect(0,0,u.width,u.height),d.drawImage(e,r,o,n,t,s,s,n,t);const h=await u.convertToBlob({type:a});return URL.createObjectURL(h)}async function Xe({sliceHeight:e,sliceWidth:t,image:n}){const{height:r,width:o}=Ke({sliceHeight:e,sliceWidth:t,image:n});return Ve({height:r,width:o,image:n})}const Ze=({rowHeight:e,columnWidth:t,totalHeight:n,totalWidth:r})=>{if(r%t!==0)throw Error("[useGrid] width out of bounds");if(n%e!==0)throw Error("[useGrid] height out of bounds");const o=r/t,s=n/e;return{columns:o,rows:s,columnWidth:t,rowHeight:e}};function et({height:e,width:t,sliceHeight:n,sliceWidth:r}){if(t>r&&t%r!==0)throw Error("[getCoordinates] width out of bounds");if(e>n&&e%n!==0)throw Error("[getCoordinates] height out of bounds");const o=[];for(let s=0;s<e;s+=n)for(let a=0;a<t;a+=r)o.push({sx:a,sy:s});return o}async function tt({image:e,pixelsPerInch:t,pageMargin:n,sliceHeightInches:r,sliceWidthInches:o,callback:s}){const a=S({inches:o,pixelsPerInch:t}),c=S({inches:r,pixelsPerInch:t}),u=et({height:e.height,width:e.width,sliceHeight:c,sliceWidth:a}),d=[];for(const{sx:h,sy:f}of u){const g=await Qe({height:c,width:a,image:e,sx:h,sy:f,margin:n});s==null||s(g),d.push(g)}return d}function nt({changeImage:e,image:t}){const{sliceHeightInches:n,sliceWidthInches:r}=R(),[o,s]=l.useState(72),{image:a,getImage:c,clearImage:u}=ee(),[d,h]=l.useState(),[f,g]=l.useState();l.useEffect(()=>{if(!t)return;const E=S({inches:r,pixelsPerInch:o}),C=S({inches:n,pixelsPerInch:o});u(),h(void 0),g(void 0),w([]),Xe({image:t,sliceHeight:C,sliceWidth:E}).then(I=>{c({src:I})})},[t,o,n,r]);const m=Q(),b=S({inches:m,pixelsPerInch:o}),[j,w]=l.useState([]);l.useEffect(()=>{if(!a)return;const E=B=>{w(H=>{const L=[...H];return L.push(B),L})},C=S({inches:r,pixelsPerInch:o}),I=S({inches:n,pixelsPerInch:o}),W=tt({image:a,pixelsPerInch:o,callback:E,pageMargin:b,sliceHeightInches:n,sliceWidthInches:r});h(W);const k=Ze({rowHeight:I,columnWidth:C,totalHeight:a.height,totalWidth:a.width});g(k)},[a,o,m,b]);const y=l.useCallback(()=>{u(),h(void 0),g(void 0),w([])},[]),x=l.useMemo(()=>a&&f?{image:a,grid:f}:void 0,[a,f]);return t&&x&&d?i.jsx(qe,{changeImage:e,composite:x,image:t,onChangePpi:y,pdfImages:d,pixelsPerInch:o,previews:j,setPixelsPerInch:s}):i.jsx(Je,{})}function ot({src:e}){const{image:t,getImage:n}=ee({src:e}),[r,o]=l.useState(),s=({files:c})=>{if(c&&c.length>0){const u=c.item(0);u?o(u):console.warn("unknown error occured during file upload")}else console.warn("file is missing")};l.useEffect(()=>{if(!r)return;const c=URL.createObjectURL(r);n({src:c})},[r]);const a=l.useCallback(c=>{s({files:c.target.files})},[]);return i.jsx(nt,{changeImage:a,image:t})}const st="/map-slicer/assets/forest-Bl8z6JIJ.jpg",rt=(e,t,n,r)=>{l.useRef(e),l.useEffect(()=>{},[e])};function it({children:e}){const[t,n]=l.useState("dark"),r=l.useMemo(()=>Ce({palette:{mode:t}}),[t]),o=l.useCallback(()=>n(a=>a==="light"?"dark":"light"),[]),s=l.useMemo(()=>({mode:t,theme:r,toggleMode:o}),[t,r]);return rt({children:e,mode:t,theme:r,memo:s}),i.jsx(Y.Provider,{value:s,children:i.jsxs(ve,{theme:r,children:[i.jsx(Ie,{enableColorScheme:!0}),e]})})}function at({children:e}){const[t,n]=l.useState("portrait"),r=l.useCallback(s=>{const a=s.currentTarget.value==="portrait"?"portrait":"landscape";n(c=>c===a?c:a)},[]),o=l.useMemo(()=>({orientation:t,setOrientation:r,pageMargin:.25}),[t]);return i.jsx(V.Provider,{value:o,children:e})}function ct({children:e}){return i.jsx(it,{children:i.jsx(at,{children:e})})}se(document.getElementById("root")).render(i.jsx(ct,{children:i.jsx(ot,{src:st})}));export{xt as _,mt as a,ft as c,pt as g};
