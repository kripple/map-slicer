import{J as r,C as a,L as ze,N as Te}from"./node-modules-U51ECZzF.js";import{B as x,d as Ee,L as $e,I as Ce,a as Ue,D as Ge,b as Le,c as Oe,e as Ne,f as Be,u as De,g as _e,h as Ae,i as Fe,T as qe,j as ve,k as Je,l as Ye,m as Ke,C as Qe,n as Ve,o as Xe,p as Ze,q as et}from"./mui-CA37r84W.js";import{E as tt}from"./jspdf-C0T4wJKz.js";import"./index-B5LckpZ_.js";import"./emotion-DhMUXl4x.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var Qt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Xt(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function s(){return this instanceof s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(s){var i=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:function(){return e[s]}})}),n}function ye({color:e}){return r.jsx(x,{bgcolor:e,height:"1px",width:"100vw"})}function he({description:e,keyValue:t}){return r.jsxs(x,{display:"flex",flexDirection:"row",children:[r.jsx(x,{sx:{minWidth:"32px"},children:r.jsx(Ee,{style:{height:"8px"}})}),r.jsx(x,{display:"inline-flex",flexWrap:"wrap",gap:.5,children:e.map((n,s)=>r.jsx(x,{ml:"punctuation"in n?-.5:0,children:"link"in n?r.jsx($e,{href:n.link,tabIndex:-1,target:"_blank",underline:"none",whiteSpace:"nowrap",children:n.text}):n.text},`${t}-${s}`))})]})}function nt(){return r.jsxs(x,{"data-testid":"Attributions",display:"flex",flexDirection:"column",gap:1.5,children:[r.jsx(he,{description:[{text:"Favicon"},{text:"by"},{text:"Twemoji",link:"https://github.com/twitter/twemoji"},{text:",",punctuation:!0},{text:"licensed"},{text:"under"},{text:"the"},{text:"CC-BY 4.0",link:"https://creativecommons.org/licenses/by/4.0"},{text:".",punctuation:!0}],keyValue:"twemoji"}),r.jsx(he,{description:[{text:"Forest"},{text:"map"},{text:"by"},{text:"Rune Foundry",link:"https://runefoundry.com/"},{text:".",punctuation:!0}],keyValue:"runefoundry"}),r.jsx(he,{description:[{text:"Built"},{text:"with"},{text:"React",link:"https://react.dev/"},{text:",",punctuation:!0},{text:"Vite",link:"https://vitejs.dev/"},{text:",",punctuation:!0},{text:"and"},{text:"Material UI",link:"https://mui.com/material-ui/"},{text:".",punctuation:!0}],keyValue:"runefoundry"})]})}const it={divider:"rgba(255, 255, 255, 0.36)",grid:"rgba(255, 255, 255, 0.12)",gray:"rgb(158, 158, 158)"},Se=a.createContext(void 0),Ie=()=>{const e=a.useContext(Se);if(!e)throw Error("useThemeContext must be called within a ThemeProvider");return e},st=()=>{const{theme:e}=Ie();return e},be=()=>{const e=st(),{colors:t}=Ie(),{primary:n,secondary:s,success:i,info:o,warning:c,error:u,background:m}=e.palette;return{primary:n.main,secondary:s.main,success:i.main,info:o.main,warning:c.main,error:u.main,background:m.default,...t}};function rt(){const{gray:e}=be(),[t,n]=a.useState(!1),s=a.useCallback(()=>{n(!0)},[]),i=a.useCallback(()=>{n(!1)},[]);return r.jsxs(x,{"data-testid":"AttributionsModal",p:0,children:[r.jsx(Ce,{color:"inherit",onClick:s,size:"small",style:{padding:0},tabIndex:-1,children:r.jsx(Ue,{fontSize:"small"})}),r.jsxs(Ge,{"aria-labelledby":"dialog-title",onClose:i,open:t,children:[r.jsxs(Le,{sx:{display:"flex",justifyContent:"space-between",p:2},children:["Attributions",r.jsx(Ce,{"aria-label":"close",onClick:i,size:"medium",style:{padding:0,color:e,height:"32px",width:"32px"},children:r.jsx(Oe,{fontSize:"medium"})})]}),r.jsx(Ne,{sx:{p:2},children:r.jsx(nt,{})})]})]})}function ot(){const e=new Date().getFullYear();return r.jsxs(x,{alignItems:"center",className:"footer",color:"gray",component:"footer",display:"flex",flexWrap:"wrap",gap:1,justifyContent:"space-between",p:2,width:"100%",children:[r.jsxs(x,{alignItems:"center",display:"flex",gap:1,whiteSpace:"nowrap",children:[r.jsx(Be,{fontSize:"small"})," ",e," Kelly Ripple"]}),r.jsx(x,{alignItems:"center",display:"flex",gap:1,whiteSpace:"nowrap",children:r.jsx(rt,{})})]})}function Pe(){return De("(max-width:750px)")}function le({color:e,component:t,testId:n,disabled:s,hiddenInput:i,icon:o,label:c,loading:u,newTab:m,tabIndex:g=0,iconButton:d,type:h="button",maxWidth:p,...y}){const C=Pe(),I={display:"flex",flexGrow:1,minHeight:"40px",whiteSpace:"nowrap"},v=d?{paddingLeft:"9px",paddingRight:"9px",minWidth:"unset"}:{},S="rgba(255, 255, 255, 0.12)",W=e?I:{...I,...v,borderBottomColor:S,borderLeftColor:S,borderRightColor:S,borderTopColor:S},H=s===!0?{disabled:s}:{};return r.jsxs(_e,{"aria-label":c,color:e||"inherit",component:t||(y.onClick?"button":"label"),"data-testid":n||"Button",fullWidth:C,loading:u,loadingPosition:"center",role:void 0,startIcon:d?void 0:o,style:W,tabIndex:g,target:m?"_blank":void 0,title:c,type:h,variant:"outlined",...y,...H,children:[d?o:c,i]})}function at({disabled:e,loading:t,onClick:n}){return r.jsx(le,{color:"secondary",disabled:e,icon:r.jsx(Ae,{}),label:"Download",loading:t,onClick:n})}function Z({units:e="inches",style:t,readOnly:n,...s}){const i=a.useMemo(()=>({InputProps:{endAdornment:e==="inches"?r.jsx(Fe,{position:"end",children:"in"}):void 0,readOnly:n}}),[e,n]);return r.jsx(qe,{autoComplete:"off",fullWidth:!1,size:"small",style:{display:"flex",flexGrow:1,...t},tabIndex:-1,type:"text",...i,...s})}function ct({canceling:e,disabled:t,loading:n,onCancel:s}){const i=Pe(),o={display:"flex",flexGrow:1};return r.jsxs(ve,{fullWidth:i,style:o,children:[r.jsx(le,{color:"success",component:"button",disabled:t,icon:r.jsx(Je,{}),iconButton:!0,label:"Apply Changes",loading:n,testId:"SubmitButton",type:"submit"}),r.jsx(le,{color:"primary",disabled:!s,icon:r.jsx(Ye,{}),iconButton:!0,label:"Undo Changes",loading:e,onClick:s})]})}function lt({disabled:e,loading:t,onChange:n}){return r.jsx(le,{color:"info",disabled:e,hiddenInput:r.jsx("input",{accept:"image/jpeg,image/png",disabled:e,hidden:!0,onChange:n,type:"file"}),icon:r.jsx(Ke,{}),label:"Upload",loading:t})}function ee(e){const[t,n]=a.useState(e),s=a.useCallback(i=>{n(i)},[]);return a.useEffect(()=>{n(e)},[e]),[t,s]}function ut(e){return typeof e=="string"}function dt(e){return e!==e}function se(e){return typeof e=="number"&&!dt(e)}const N=(e,t={integer:!1})=>{const n=[".","0","1","2","3","4","5","6","7","8","9"];t.integer&&n.shift();const s=[];for(const i of e)n.includes(i)&&(s.push(i),i==="."&&n.shift());return s.join("")},We=(e,t={integer:!1})=>{const n=Math.abs(e);return n>99999?99999:t!=null&&t.integer?Math.ceil(n):Math.round(n*100)/100},mt=(e,t={integer:!1})=>{const n=N(e),s=parseFloat(n);return Number.isNaN(s)?"":We(s,t).toString()};function R(e,t={integer:!1}){if(se(e))return We(e,t);if(ut(e))return mt(e,t);throw TypeError}const fe=e=>`${e.toFixed(2)}px`,E=(e,t)=>{if(t&&t.minimum&&t.maximum&&t.minimum>t.maximum)throw Error(`[getNumber] minimum value '${t.minimum}' is greater than maximum value '${t.maximum}'`);const n=se(t==null?void 0:t.minimum)?t.minimum:0,s=se(t==null?void 0:t.maximum)?t.maximum:void 0,i=parseFloat(e);return se(i)?s===void 0?Math.max(n,i):Math.min(Math.max(n,i),s):n},ue=({size:e,imageSize:t})=>e>=t?1:Math.ceil(t/e);function te(e,t,n={integer:!1}){const s=se(e)?e.toString():e;return t===""||(t&&s?R(t,{integer:n.integer})!==R(s,{integer:n.integer}):!1)}const pe=({inches:e,pixelsPerInch:t})=>Math.floor(e*t),ne=({pixels:e,pixelsPerInch:t})=>e/t,ae=({inches:e,pixels:t})=>{const n=Math.floor(t/e);return n>0?n:1},ce=1,de=2.5,me=100,gt=({imageHeight:e,imageHeightPixels:t,imageWidth:n,imageWidthPixels:s})=>{const c=e>=n?t:s,u=Math.max(Math.ceil(c/100),1);return{minimumPixelsPerInch:u,maximumImageHeight:R(ne({pixelsPerInch:u,pixels:t})),maximumImageWidth:R(ne({pixelsPerInch:u,pixels:s}))}},Me=({height:e,width:t})=>{const n=Math.min(e,t);return R(n/4)};function ht({changeImage:e,image:t,download:n,update:s,...i}){const o=Pe(),[c,u]=ee(i.imageHeight),[m,g]=ee(i.imageWidth),[d,h]=ee(i.pageHeight.toString()),[p,y]=ee(i.pageWidth.toString()),[C,I]=ee(i.pageMargin.toString()),[v,S]=ee(i.pixelsPerInch.toString()),W=a.useCallback(P=>{const w=N(P.currentTarget.value);u(w||" ")},[]),H=a.useCallback(P=>{const w=N(P.currentTarget.value);g(w||" ")},[]),$=a.useCallback(P=>{const w=N(P.currentTarget.value);h(w||" ")},[]),B=a.useCallback(P=>{const w=N(P.currentTarget.value);y(w||" ")},[]),U=a.useCallback(P=>{const w=N(P.currentTarget.value);I(w||" ")},[]),D=a.useCallback(P=>{const w=N(P.currentTarget.value,{integer:!0});S(w||" ")},[]),z=te(i.imageHeight,c),T=te(i.imageWidth,m),_=te(i.pageHeight,d),re=te(i.pageWidth,p),A=te(i.pageMargin,C),F=te(i.pixelsPerInch,v,{integer:!0}),q=z||T||_||re||A||F,j=a.useCallback(({margin:P,nextPageHeight:w,nextPageWidth:Y,image:K})=>{const Q=2*P,V=w-Q,X=Y-Q,f=ue({size:X,imageSize:K.width}),l=ue({size:V,imageSize:K.height});return f*l},[]),J=a.useCallback(P=>{if(P.preventDefault(),!t||!s)throw Error("[handleUpdate] missing required properties");const w=E(c,{minimum:ce}),Y=E(m,{minimum:ce}),{minimumPixelsPerInch:K,maximumImageHeight:Q,maximumImageWidth:V}=gt({imageHeight:w,imageHeightPixels:t.height,imageWidth:Y,imageWidthPixels:t.width}),X=z?ae({inches:Math.min(w,Q),pixels:t.height}):T?ae({inches:Math.min(Y,V),pixels:t.width}):E(v,{minimum:K}),f=Math.min(ae({inches:ce,pixels:t.height}),ae({inches:ce,pixels:t.width})),l=Math.min(X,f),b=E(d,{minimum:de,maximum:me}),M=E(p,{minimum:de,maximum:me}),ge=Me({width:M,height:b}),oe=E(C,{maximum:ge}),k=ne({pixels:t.height,pixelsPerInch:l}),O=ne({pixels:t.width,pixelsPerInch:l}),G=j({nextPageHeight:b,nextPageWidth:M,margin:oe,image:t}),ie=j({nextPageHeight:M,nextPageWidth:b,margin:oe,image:t})<G;s({imageHeight:R(k.toString()),imageWidth:R(O.toString()),pageHeight:ie?M:b,pageWidth:ie?b:M,pageMargin:oe,pixelsPerInch:l}),L()},[c,m,d,p,C,v,s]),L=a.useCallback(()=>{u(i.imageHeight),g(i.imageWidth),h(i.pageHeight.toString()),y(i.pageWidth.toString()),I(i.pageMargin.toString()),S(i.pixelsPerInch.toString())},[i.imageHeight,i.imageWidth,i.pageHeight,i.pageWidth,i.pageMargin,i.pixelsPerInch]);return r.jsxs(x,{alignItems:"center",component:"header","data-testid":"Header",display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center",p:2,position:"relative",width:"100%",children:[r.jsxs(ve,{orientation:"horizontal",style:{flexGrow:1,justifyContent:"center",display:"grid",gridTemplateColumns:"repeat(2, 1fr)"},children:[r.jsx(lt,{disabled:!e,onChange:e}),r.jsx(at,{disabled:!n||q,onClick:n})]}),r.jsx("form",{autoComplete:"off",noValidate:!0,onSubmit:J,style:{display:"flex",flexGrow:1},children:r.jsxs(x,{display:"flex",flexGrow:1,flexWrap:"wrap",gap:2,children:[r.jsxs(x,{display:"flex",flexGrow:1,gap:2,children:[r.jsx(Z,{disabled:z||F,label:"Width",name:"imageWidth",onChange:H,value:m||" "}),r.jsx(Z,{disabled:T||F,label:"Height",name:"imageHeight",onChange:W,value:c||" "})]}),r.jsx(Z,{disabled:z||T,label:"DPI",name:"pixelsPerInch",onChange:D,style:{display:o?"none":"flex"},units:"none",value:v.toString()}),r.jsxs(x,{display:o?"none":"flex",flexGrow:1,gap:2,children:[r.jsx(Z,{label:"Paper Width",name:"pageWidth",onChange:B,style:{display:o?"none":"flex"},value:p}),r.jsx(Z,{label:"Paper Height",name:"pageHeight",onChange:$,style:{display:o?"none":"flex"},value:d})]}),r.jsx(Z,{label:"Print Margin",name:"pageMargin",onChange:U,style:{display:o?"none":"flex"},value:C.toString()}),r.jsx(ct,{disabled:!q,onCancel:q?L:void 0})]})})]})}function pt({margin:e,src:t}){return t?r.jsx(Qe,{image:t,style:{position:"absolute",top:e,bottom:e,left:e,right:e,animationName:"appear",animationDuration:"200ms",animationIterationCount:1,animationTimingFunction:"ease-in"}}):null}function ft({composite:{previews:e,props:{columnCount:t,rowCount:n,pageCount:s,screenPadding:i,screenGridHeight:o,screenGridWidth:c}}}){const[u,m]=a.useState(Array(s).fill({src:void 0}));return a.useEffect(()=>{const g=e.concat(Array(s-e.length).fill({src:void 0}));m(g)},[e,s]),r.jsx(x,{alignContent:"center",bottom:"0",display:"grid",gridTemplateColumns:`repeat(${t}, ${fe(c)})`,gridTemplateRows:`repeat(${n}, ${fe(o)})`,justifyContent:"center",left:"0",position:"absolute",right:"0",top:"0",children:u.map(({src:g,pageNumber:d},h)=>{const p=`${i/2}px`;return r.jsx(x,{position:"relative",children:r.jsx(pt,{margin:p,src:g})},g?`page-${d}`:`placeholder-${h}`)})})}function xt({screenSizeRef:e}){return r.jsx(x,{height:"100%",position:"absolute",ref:e,width:"100%"})}const He=e=>{const t=a.useRef(!0);a.useEffect(()=>{t.current&&(t.current=!1,e())},[])};function bt(){const{gray:e}=be(),t=a.useRef(),[n,s]=a.useState(!1);return He(()=>(t.current=setTimeout(()=>{s(!0)},1e3),()=>{t.current&&clearTimeout(t.current)})),n?r.jsx(x,{alignContent:"center",alignItems:"center",bottom:"0",display:"flex",justifyContent:"center",left:"0",position:"absolute",right:"0",top:"0",children:r.jsx(Ve,{sx:{color:e,height:"66%",width:"66%",animation:"spin 3s linear infinite"}})}):null}function Pt({props:e,previews:t,screenSizeRef:n}){return r.jsxs(x,{"data-testid":"Previews",display:"flex",flexDirection:"column",height:"100%",position:"relative",width:"100%",children:[r.jsx(xt,{screenSizeRef:n}),e?r.jsx(ft,{composite:{previews:t||[],props:e}}):r.jsx(bt,{})]})}const wt={useResizeDetector:ze},ke=a.createContext(void 0),Ct=()=>{const e=a.useContext(ke);if(!e)throw Error("useParamsContext must be called within a ParamsProvider");return e},Re=a.createContext(void 0),yt=()=>{const e=a.useContext(Re);if(!e)throw Error("useStatusContext must be called within a StatusProvider");return e},jt=()=>{const{isUpdating:e,setIsUpdating:t}=yt();return[e,t]},vt=e=>jt,St=e=>vt()(),It="production",Wt="fb1acfc60df20613c09b09dae4a643f94ff65f77",Mt=({image:e,compositeHeight:t,compositeWidth:n})=>{if(t===0||n===0)throw Error("[getCompositeUrlPromise] dimensions are invalid");const s="image/png",i=new OffscreenCanvas(n,t),o=i.getContext("2d");if(o===null)throw Error("[getCompositeUrlPromise] null context");o.fillStyle="white",o.fillRect(0,0,i.width,i.height);const c=Math.floor((i.width-e.width)/2),u=Math.floor((i.height-e.height)/2);return o.drawImage(e,c,u,e.width,e.height),i.convertToBlob({type:s}).then(g=>URL.createObjectURL(g))},Ht=({src:e,onload:t})=>{const n=new Image;return n.src=e,t&&(n.onload=t),n},xe=({src:e})=>new Promise(t=>{const n=Ht({src:e,onload:function(){t(n)}})}),kt=({image:e,pageImageHeight:t,pageImageWidth:n})=>{const s=ue({size:n,imageSize:e.width}),i=ue({size:t,imageSize:e.height}),o=t*i,c=n*s,u=[];let m=1;for(let d=0;d<o;d+=t)for(let h=0;h<c;h+=n)u.push({sx:h,sy:d,pageNumber:m}),m+=1;return{compositeHeight:o,compositeWidth:c,rowCount:i,columnCount:s,pageCount:i*s,coordinates:u}},Rt=({screenHeight:e,screenWidth:t,columnCount:n,rowCount:s,pageHeight:i,pageWidth:o,pageHeightInches:c,pageWidthInches:u})=>{const g=t/n-4,d=e/s-4,h=g/o,p=d/i,y=Math.min(h,p),C=y*o,I=y*i,v=C+4,S=I+4,W=g/u,H=d/c;return{screenSpacing:Math.min(W,H),screenPadding:4,screenGridHeight:S,screenGridWidth:v}};function zt({image:e,pageHeight:t,pageWidth:n,pageMargin:s,pixelsPerInch:i,screenHeight:o,screenWidth:c,resize:u}){const m=pe({inches:t,pixelsPerInch:i}),g=pe({inches:n,pixelsPerInch:i}),d=pe({inches:s,pixelsPerInch:i}),h=2*d,p=m-h,y=g-h,C=ne({pixels:p,pixelsPerInch:i}),I=ne({pixels:y,pixelsPerInch:i}),{compositeHeight:v,compositeWidth:S,rowCount:W,columnCount:H,pageCount:$,coordinates:B}=kt({image:e,pageImageHeight:p,pageImageWidth:y}),{screenSpacing:U,screenPadding:D,screenGridHeight:z,screenGridWidth:T}=Rt({screenHeight:o,screenWidth:c,pageHeight:m,pageWidth:g,columnCount:H,rowCount:W,pageHeightInches:t,pageWidthInches:n});return u?{screenSpacing:U,screenPadding:D,screenGridHeight:z,screenGridWidth:T}:Mt({compositeHeight:v,compositeWidth:S,image:e}).then(_=>xe({src:_}).then(A=>({id:A.src,composite:A,rowCount:W,columnCount:H,pageCount:$,coordinates:B,pageHeight:m,pageWidth:g,pageMargin:d,pageHeightInches:t,pageWidthInches:n,pageMarginInches:s,pageImageHeight:p,pageImageWidth:y,pageImageHeightInches:C,pageImageWidthInches:I,screenSpacing:U,screenPadding:D,screenGridHeight:z,screenGridWidth:T})))}const Tt=({id:e,composite:t,height:n,width:s,sx:i,sy:o,margin:c,pageNumber:u,pageCount:m})=>{if(n===0||s===0)throw Error("[getPagePromise] dimensions are invalid");const g="image/png",d=c*2,h=new OffscreenCanvas(s+d,n+d),p=h.getContext("2d");if(p===null)throw Error("[getPagePromise] null context");return p.fillStyle="white",p.fillRect(0,0,h.width,h.height),p.drawImage(t,i,o,s,n,c,c,s,n),h.convertToBlob({type:g}).then(C=>({src:URL.createObjectURL(C),pageNumber:u,pageCount:m,id:e}))},Et="modulepreload",$t=function(e){return"/map-slicer/"+e},je={},Zt=function(t,n,s){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.all(n.map(u=>{if(u=$t(u),u in je)return;je[u]=!0;const m=u.endsWith(".css"),g=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${g}`))return;const d=document.createElement("link");if(d.rel=m?"stylesheet":Et,m||(d.as="script",d.crossOrigin=""),d.href=u,c&&d.setAttribute("nonce",c),document.head.appendChild(d),m)return new Promise((h,p)=>{d.addEventListener("load",h),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${u}`)))})}))}return i.then(()=>t()).catch(o=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o})},Ut=({images:e,height:t,width:n})=>{const s={orientation:n>t?"landscape":"portrait",format:[n,t],unit:"in"},i="PNG";return e.reduce((o,c,u)=>{const m=u+1,g={format:i,imageData:c,x:0,y:0,width:n,height:t};return o.addImage(g),m!==e.length&&o.addPage(s.format,s.orientation),o},new tt(s)).output("datauristring")};function Gt({changeImage:e,image:t}){var V,X;const n=a.useCallback(zt,[]),s=a.useCallback(Tt,[]),[,i]=St(),o=a.useRef(),c=a.useCallback(f=>new Promise((l,b)=>{if(f.id!==o.current)b("id mismatch");else{const M=s(f);l({promise:M,reject:b})}}),[]),u=Ct(),m=be(),{height:g,width:d,ref:h}=wt.useResizeDetector({refreshMode:"throttle",refreshRate:50}),p=a.useRef(),y=a.useRef(!0),[C,I]=a.useState();a.useEffect(()=>{if(!g||!d)return;if(y.current){y.current=!1,I({screenHeight:g,screenWidth:d});return}if(!p.current)return;const f=n({...p.current,screenHeight:g,screenWidth:d,resize:!0});F(f.screenSpacing),J(l=>!l.image||!l.previews||!l.props?l:{...l,props:{...l.props,screenPadding:f.screenPadding,screenGridHeight:f.screenGridHeight,screenGridWidth:f.screenGridWidth}})},[g,d]);const[v,S]=a.useState(u.pageMargin),[W,H]=a.useState(u.pageHeight),[$,B]=a.useState(u.pageWidth),[U,D]=a.useState(72),[z,T]=a.useState("16"),[_,re]=a.useState("23"),[A,F]=a.useState(0),q=fe(A),[j,J]=a.useState({}),L=a.useRef(),P=a.useCallback(f=>{f.id===o.current&&J(l=>{const b=l.previews?[...l.previews]:[];return b.push(f),{...l,previews:b}})},[]);a.useEffect(()=>{if(!t||!C)return;const f={image:t,pageMargin:v,pageHeight:W,pageWidth:$,pixelsPerInch:U,screenHeight:C.screenHeight,screenWidth:C.screenWidth};p.current=f,w(),n(f).then(l=>{o.current=l.composite.src,F(l.screenSpacing),J({image:l.composite,props:{columnCount:l.columnCount,rowCount:l.rowCount,pageCount:l.pageCount,screenPadding:l.screenPadding,screenGridHeight:l.screenGridHeight,screenGridWidth:l.screenGridWidth}}),L.current={height:l.pageImageHeightInches,width:l.pageImageWidthInches};const b=[];for(const[k,{sx:O,sy:G}]of l.coordinates.entries())b.push({id:l.id,height:l.pageImageHeight,width:l.pageImageWidth,composite:l.composite,sx:O,sy:G,margin:l.pageMargin,pageNumber:k+1,pageCount:l.pageCount});const M=b.shift();if(!M)return;const ge=c(M);b.reduce((k,O)=>k.then(({promise:G,reject:we})=>G.then(ie=>(ie.id!==o.current?we("id mismatch"):P(ie),c(O)))),ge).then(({promise:k,reject:O})=>k.then(G=>{G.id!==o.current?O("id mismatch"):(P(G),i(!1))})).catch(k=>{k!=="id mismatch"&&console.warn(k)})}).catch(l=>{l!=="id mismatch"&&console.warn(l)})},[t,W,$,v,U,C]);const w=a.useCallback(()=>{J({}),o.current=void 0},[]),Y=a.useCallback(f=>{T(f.imageHeight),re(f.imageWidth),S(f.pageMargin),H(f.pageHeight),B(f.pageWidth),D(f.pixelsPerInch)},[]),K=L.current&&j.previews&&((V=j.props)==null?void 0:V.pageCount)&&j.props.pageCount===j.previews.length,Q=a.useCallback(()=>{var b;if(!(L.current&&j.previews&&((b=j.props)!=null&&b.pageCount)&&j.props.pageCount===j.previews.length))throw Error("[createPdf] missing required properties");const f=Ut({...L.current,images:j.previews.map(M=>M.src)}),l=document.createElement("a");l.download="download",l.href=f,l.click()},[j.previews,(X=j.props)==null?void 0:X.pageCount]);return r.jsxs(x,{alignItems:"center","data-env":It,"data-testid":"App","data-version":Wt,display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",children:[r.jsx(ht,{changeImage:e,download:K?Q:void 0,image:t,imageHeight:z,imageWidth:_,pageHeight:W,pageMargin:v,pageWidth:$,pixelsPerInch:U,update:t?Y:void 0}),r.jsx(ye,{color:m.divider}),r.jsx(x,{alignItems:"center",boxSizing:"border-box",component:"main",display:"flex",flexGrow:1,justifyContent:"center",p:2,position:"relative",style:{transition:"background-size 2s ease-out",backgroundSize:`${q} ${q}`,backgroundImage:`linear-gradient(to right, ${m.grid} 1px, transparent 1px), linear-gradient(to bottom, ${m.grid} 1px, transparent 1px)`,backgroundPosition:"center"},width:"100%",children:r.jsx(Pt,{previews:j.previews,props:j.props,screenSizeRef:h})}),r.jsx(ye,{color:m.divider}),r.jsx(ot,{})]})}function Lt({children:e}){const t=a.useMemo(()=>{const n=new URLSearchParams(window.location.search),s=R(E(n.get("paperHeight")||"11",{minimum:de,maximum:me})),i=R(E(n.get("paperWidth")||"8.5",{minimum:de,maximum:me})),o=Me({height:s,width:i}),c=R(E(n.get("printMargin")||"0.25",{maximum:o}));return{pageHeight:s,pageWidth:i,pageMargin:c}},[]);return r.jsx(ke.Provider,{value:t,children:e})}function Ot({src:e}){const[t,n]=a.useState(null),[s,i]=a.useState(null);He(()=>{xe({src:e}).then(u=>{i(u)})});const o=a.useCallback(u=>{(({files:g})=>{if(g&&g.length>0){const d=g.item(0);if(d){const h=URL.createObjectURL(d);xe({src:h}).then(p=>{n(p)})}else console.warn("[ImageLoader] unknown error occured during file upload")}else console.warn("[ImageLoader] file is missing")})({files:u.target.files})},[]),c=t||s;return r.jsx(Lt,{image:c,children:r.jsx(Gt,{changeImage:o,image:c})})}const Nt="/map-slicer/assets/forest-Bl8z6JIJ.jpg",Bt=(e,t,n,s)=>{a.useRef(e),a.useEffect(()=>{},[e])};function Dt({children:e}){const[t,n]=a.useState("dark"),s=a.useMemo(()=>Xe({components:{MuiButtonBase:{defaultProps:{focusRipple:!1}}},palette:{mode:t}}),[t]),i=a.useCallback(()=>n(c=>c==="light"?"dark":"light"),[]),o=a.useMemo(()=>({colors:it,mode:t,theme:s,toggleMode:i}),[t,s]);return Bt({children:e,mode:t,theme:s,memo:o}),r.jsx(Se.Provider,{value:o,children:r.jsxs(Ze,{theme:s,children:[r.jsx(et,{enableColorScheme:!0}),e]})})}function _t({children:e}){const[t,n]=a.useState(!1),s=a.useMemo(()=>({isUpdating:t,setIsUpdating:i=>n(i)}),[t]);return r.jsx(Re.Provider,{value:s,children:e})}function At({children:e}){return r.jsx(Dt,{children:r.jsx(_t,{children:e})})}Te(document.getElementById("root")).render(r.jsx(At,{children:r.jsx(Ot,{src:Nt})}));export{Zt as _,Vt as a,Qt as c,Xt as g};
